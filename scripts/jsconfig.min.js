define("views/signin",[],function(){var e=null,t=null,n={all:".signinsubview",start:".signinstart",signin:".signinview",forgotInfo:".signinforgotinfo",reg1:".signinregister1",reg2:".signinregister2",valEmail:".signinEmailValidate",toc:".signintoc"},r=function(e,r,i){gdd.utils.slideTransitionView($(n.all),$(e),r,function(){switch(e){case n.start:t?(t.destroySlider(),t=$("#signinBxSlider").bxSlider({controls:!1,mode:"horizontal",useCSS:!0,easing:"easeOutBack",speed:1e3,pager:!0})):t=$("#signinBxSlider").bxSlider({controls:!1,mode:"horizontal",useCSS:!0,easing:"easeOutBack",speed:1e3,pager:!0});break;case n.search:break;case n.duplicates:break;case n.selectedPerson:}i&&i()})},i=function(){$("#signinPortalList").listview("refresh"),$(".chooseportal").off().on(gdd.utils.click,function(){var e=$(this).attr("data-id"),t=$(this).attr("data-name");gdd.session.loadForPublicAccess(e,t),gdd.loadPage(gdd.pages.home)})},s=function(){$("#signinPortalList").listview("refresh"),$(".chooseportal").off().on(gdd.utils.click,function(){var t=$(this).attr("data-id"),i=$(this).attr("data-name");e.regInfo.portalId(t),e.regInfo.portalName(i),r(n.reg2,"left")})},o=function(){$("#signinPortalList").listview("refresh"),$(".chooseportal").off().on(gdd.utils.click,function(){var e=$(this).attr("data-id"),t=$(this).attr("data-name");gdd.showLoader("Connecting to '"+t+"'"),gdd.api.callApi("Security/CreateSession","POST",{portalId:e},{success:function(e){gdd.hideLoader(),gdd.storage.saveSessionInfo(e.gddData),gdd.session.startNewSession()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})})},u=function(){$("#btnSignInChurchMissing").on(gdd.utils.click,function(){gdd.utils.showPopup("popupMissingChurch")}),$("#btnRecoverInfo").on(gdd.utils.click,function(){var e=$("#txtRecover").val();if(e){var t="",i="";e.indexOf("@")>-1?(i=e,gdd.showLoader("Recovering using email...")):(gdd.showLoader("Recovering using username..."),t=e),gdd.api.callApi("Security/RecoverInfo","GET",{userName:t,email:i},{success:function(e){gdd.hideLoader(),gdd.showMsg(e.gddData,function(){r(n.signin,"down")})},fail:function(e){e.msg.indexOf("no user")>-1?(gdd.hideLoader(),t?gdd.showMsg("There is no matching username in the system."):gdd.showMsg("There is no matching user in the system with this email address.")):(gdd.hideLoader(),gdd.showErr(e.msg))}})}else gdd.showMsg("Please enter either your username or email address.")}),$("#btnResendEmail").on(gdd.utils.click,function(){gdd.showLoader("Sending email..."),gdd.api.callApi("Security/SendVerificationEmail","GET",{userId:gdd.session.auth.userId()},{success:function(e){gdd.hideLoader(),gdd.showMsg(e.gddData,function(){r(n.signin,"up")})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.message)}})}),$("#frmReg2").validate({rules:{txtRegFName:{required:!0},txtRegLName:{required:!0},txtRegMobile:{required:!0},txtRegEmail:{required:!0,email:!0}},highlight:function(e){$(e).closest(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(e){$(e).closest(".form-group").removeClass("has-error").addClass("has-success")},errorPlacement:function(e,t){return null}}),$("#btnSignIn").on(gdd.utils.click,function(){var e={};e.username=$("#txtUserName").val(),e.password=$("#txtPassword").val(),e.username&&e.password?(gdd.showLoader("Logging in..."),gdd.api.callApi("Security/Authenticate","POST",e,{success:function(e){gdd.hideLoader(),gdd.storage.saveAuthInfo(e.gddData),ko.mapping.mergeFromJS(gdd.session.auth,e.gddData);if(e.gddData.sts=="1")if(e.gddData.authorizedPortals.length>0){var t=e.gddData.authorizedPortals[0].portalId,i=e.gddData.authorizedPortals[0].portalName;gdd.showLoader("Connecting to '"+i+"'"),gdd.session.endOldSession(),gdd.api.callApi("Security/CreateSession","POST",{portalId:t},{success:function(e){gdd.hideLoader(),gdd.storage.saveSessionInfo(e.gddData),gdd.session.startNewSession()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}else gdd.showLoader("Loading church info..."),a(function(){r(n.reg1,"up"),gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)},o);else e.gddData.sts=="2"?r(n.valEmail,"up"):gdd.showErr("Invalid return status, please contact support")},fail:function(e){gdd.hideLoader(),e.msg.indexOf("username and password")>-1?gdd.showMsg("The username/password combination you entered is not valid. Please try again."):gdd.showErr(e.msg)}})):gdd.showMsg("Please enter a valid username and password.")}),$(".btnViewTocDetail").on(gdd.tap(),function(){$.when($("#signintocsummary").hide("slide",{direction:"up"})).then(function(){$("#signintocdetail").show("slide",{direction:"down"})})}),$(".btnSkipRegContinueToApp").on(gdd.utils.click,function(){gdd.showLoader("Loading churches..."),a(function(){gdd.cache.appPortals().length===1?(gdd.session.loadForPublicAccess(gdd.cache.appPortals()[0].portalId,gdd.cache.appPortals()[0].portalName),gdd.loadPage(gdd.pages.home)):r(n.reg1,"up"),gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)},i)}),$(".btnLoginIn").on(gdd.utils.click,function(){gdd.storage.savePublicAccessToken(null),gdd.session.activeSession.portalId(""),gdd.session.activeSession.portalName(""),e.signUpFromAppRequested=!1,r(n.signin,"up")}),$(".btnForgotInfo").on(gdd.utils.click,function(){r(n.forgotInfo,"up")}),$(".btnSignInHeaderCancel").on(gdd.tap(),function(){r(n.start,"down")}),$("#btnTOCAccept").on(gdd.utils.click,function(){e.signUpFromAppRequested?r(n.reg2,"left"):(gdd.showLoader("Loading registration data..."),a(function(){if(gdd.cache.appPortals().length===1){var t=gdd.cache.appPortals()[0].portalId,i=gdd.cache.appPortals()[0].portalName;e.regInfo.portalId(t),e.regInfo.portalName(i),r(n.reg2,"left")}else r(n.reg1,"up");gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)},s))}),$("#btnTOCDecline").on(gdd.utils.click,function(){r(n.start,"down")}),$(".btnRegisterNewAccount").on(gdd.utils.click,function(){$("#signintocsummary").show(),$("#signintocdetail").hide(),r(n.toc,"up")}),$(".btnGoReg1").on(gdd.utils.click,function(){e.signUpFromAppRequested?r(n.start,"down"):r(n.reg1,"right")}),$("#btnRegisterAccount").on(gdd.utils.click,function(){if($("#frmReg2").valid()){e.regInfo.userName($("#txtRegEmail").val()),e.regInfo.password($("#txtRegPwd").val());var t=ko.mapping.toJS(e.regInfo);if(t.userName||t.password){var i=!1,s=t.password.length;if(s<5)i=!1;else{var o=/(?!^[0-9]*$)(?!^[a-zA-Z]*$)^([a-zA-Z0-9]{5,20})$/g;i=o.test($("#txtRegPwd").val())}i?$("#txtRegPwd").val()===$("#txtRegPwdC").val()?(gdd.showLoader("Checking email..."),gdd.api.callApi("Security/EmailIsAvailable","GET",{email:e.regInfo.email()},{success:function(i){gdd.hideLoader(),i.gddData==="1"?(gdd.showLoader("Registering account..."),gdd.api.callApi("Security/RegisterNewUser","POST",t,{success:function(t){gdd.hideLoader();var i=function(){e.regInfo.firstName(""),e.regInfo.lastName(""),e.regInfo.email(""),e.regInfo.userName(""),e.regInfo.password(""),$(".regInput").val(""),r(n.signin,"up")};t.gddData.status===1?gdd.showMsg(t.gddData.message,i):t.gddData.status===2?gdd.showMsg(t.gddData.message,i):gdd.showErr("The server returned am undefined status. Please contact support.",i)},fail:function(t){gdd.hideLoader(),t.msg.indexOf("has already been taken")>-1?($("#usernamePopupTxt").html(e.regInfo.userName()),gdd.showPopup("popupUserNameExists")):gdd.showErr(t.msg)}})):($("#emailPopupTxt").html(e.regInfo.email()),gdd.showPopup("popupEmailExists"))},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})):gdd.showMsg("Your passwords do not match."):$("#popupPwdInfo").popup("open",{transition:"slideup"})}else gdd.showMsg("Please enter a valid username and password.")}else gdd.showMsg("Please provide valid entries for all the fields above.")})},a=function(e,t,n){gdd.cache.appPortals().length>0?(n(),e()):gdd.api.callApi("Admin/SearchPortals","GET",{searchstring:""},{success:function(r){gdd.cache.appPortals.removeAll(),$.each(r.gddData,function(e,t){gdd.cache.appPortals.push(t)}),gdd.hideLoader(),gdd.cache.appPortals().length>0?(n(),e()):t("This app has not been connected to any churches. Please contact support.")},fail:function(e){t(e.msg)}})};return{signUpFromAppRequested:!1,regInfo:{firstName:ko.observable(""),lastName:ko.observable(""),email:ko.observable(""),userName:ko.observable(""),password:ko.observable(""),mobileNumber:ko.observable(""),portalId:ko.observable(""),portalName:ko.observable("")},create:function(){e=this,gdd.utils.configMergeFromJs(ko)},show:function(){gdd.utils.activePage=gdd.pages.signin,ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id)),u(),$("#idxContent").show(),$("#signinContent").show(),e.signUpFromAppRequested?(e.regInfo.portalId(gdd.session.activeSession.portalId()),e.regInfo.portalName(gdd.session.activeSession.portalName()),r(n.toc,"down")):(gdd.session.startProfile.forceRegistration()?($(".btnSkipRegContinueToApp").hide(),$("#btnMainRegister").show()):($(".btnSkipRegContinueToApp").show(),$("#btnMainRegister").hide()),$(".signinsubview").hide(),r(n.start,"down",function(){}))},beforeShow:function(){},beforeHide:function(){}}}),define("views/index",[],function(){var e=null,t=function(){};return{create:function(){e=gdd.utils.activePage.view},show:function(){},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/moreInfo",[],function(){var e=function(){$("#btnHome").on("click",function(){gdd.loadPage(gdd.pages.home)}),$("#btnBoucne").on("click",function(){$("#toggle").toggle("bounce",{times:3},"slow")})};return{create:function(){},show:function(){},beforeShow:function(){e()},beforeHide:function(){},endOldSession:function(){}}}),define("views/home",[],function(){var e=null,t=function(){$("#btnHomeTestSMS").on(gdd.tap(),function(){try{var e=$("#smsNumbers").val(),t="Hello",n=$("#smsIntent").val(),r=function(){alert("Message sent successfully")},i=function(e){alert("Message Failed:"+e)};sms.send(e,t,n,r,i)}catch(s){alert("Error: "+JSON.stringify(s))}}),$("#btnHomeSignOut").on(gdd.tap(),function(){gdd.session.signOut()}),$(".btnGoSettings").off().on(gdd.click(),function(){var e={positionTo:$(this)};gdd.utils.showPopup("popupSettings",e)}),$(".btnGoNews").off().on(gdd.tap(),function(){gdd.loadPage(gdd.pages.news)}),$("#btnGoPortals").off().on(gdd.click(),function(){$("#popupSettings").one("popupafterclose",function(e,t){gdd.loadPage(gdd.pages.portals,!1)}),$("#popupSettings").popup("close")}),$(".btnGoTemp").off().on(gdd.tap(),function(){alert("Launch Module")}),$("#btnHomeTestPeople").off().on(gdd.tap(),function(){e=null,gdd.pages.people.view.clb=function(t){gdd.loadPage(gdd.pages.home,!0),e=t},gdd.loadPage(gdd.pages.people)})};return{create:function(){},show:function(){ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id)),e&&(alert(JSON.stringify(e)),e=null)},beforeShow:function(){t()},beforeHide:function(){},endOldSession:function(){}}}),define("views/portals",[],function(){var e=null,t={all:".portalView",signin:".signInNewPortal",remove:".removePortal",add:".addNewPortal"},n=function(){$("#portalsRemoveList").listview("refresh"),$("#portalsSignInList").listview("refresh"),$(".currentportal").off().on(gdd.utils.click,function(){var e=$(this).attr("data-id"),t=$(this).attr("data-name"),n=$(this).closest("ul");n[0].id==="portalsRemoveList"?gdd.portalId()==e?gdd.showMsg("You cannot remove a database when you are signed into it. Please signout first."):s(e,!1):(gdd.showLoader("Connecting to '"+t+"'"),gdd.session.endOldSession(),gdd.api.callApi("Security/CreateSession","POST",{portalId:e},{success:function(e){gdd.hideLoader(),gdd.storage.saveSessionInfo(e.gddData),gdd.session.startNewSession()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))})},r=function(){$("#portalsNewList").listview("refresh"),$(".addportal").off().on(gdd.utils.click,function(){var e=$(this).attr("data-id"),t=$(this).attr("data-name");s(e,!0)}),$("#portalsContent").fadeIn()},i=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.signin:$("#portalHeader").html("Sign In");break;case t.remove:$("#portalHeader").html("Remove");break;case t.add:$("#portalHeader").html("Add")}r&&r()})},s=function(e,t){t?gdd.showLoader("Activating..."):gdd.showLoader("De-Activating..."),gdd.api.callApi("Security/ToggleUserPortalActiveStatus","GET",{portalId:e,isActive:t},{success:function(e){gdd.hideLoader();if(t){var n=$.grep(gdd.session.auth.authorizedPortals(),function(t,n){return t.portalId==e.gddData.portalId});n.length===0&&(gdd.session.auth.authorizedPortals.push({portalId:e.gddData.portalId,portalName:e.gddData.portalName}),gdd.storage.saveAuthInfo(ko.mapping.toJS(gdd.session.auth)),$("#portalsRemoveList").listview("refresh"),$("#portalsSignInList").listview("refresh"))}else{var n=$.grep(gdd.session.auth.authorizedPortals(),function(t,n){return t.portalId==e.gddData.portalId});n.length>0&&(gdd.session.auth.authorizedPortals.splice(gdd.session.auth.authorizedPortals.indexOf(n[0]),1),gdd.storage.saveAuthInfo(ko.mapping.toJS(gdd.session.auth)))}},fail:function(e){gdd.hideLoader(),gdd.showErr(err.msg)}})},o=function(){$(".btnShowRemovePortal").on(gdd.utils.tap,function(){i(t.remove,"left")}),$(".btnShowAddPortal").on(gdd.utils.tap,function(){i(t.add,"left")}),$(".btnSignInPortal").on(gdd.utils.tap,function(){i(t.signin,"right")})};return{create:function(){e=this,gdd.utils.configMergeFromJs(ko),currView=t.signin,ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id)),o()},show:function(){n(),gdd.cache.appPortals().length>0?r():(gdd.showLoader("Loading churches..."),gdd.api.callApi("Admin/SearchPortals","GET",{searchstring:"f"},{success:function(e){gdd.cache.appPortals.removeAll(),$.each(e.gddData,function(e,t){gdd.cache.appPortals.push(t)}),gdd.hideLoader(),gdd.cache.appPortals().length>0?r():fail("This app has not been connected to any churches. Please contact support.")},fail:function(e){gdd.showErr(e.msg)}}))},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/news",[],function(){var e=null,t={all:".newsView",feed:".newsFeed",newsItem:".newsItem",noNews:".noNews",addNews:".newsFlashAdd"},n=0,r=10,i=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.feed:$("#newsHeader").html("News"),gdd.session.activeSession.permissions.manageNewsItems?$(".btnGoToAddNewsFlash").show():$(".btnGoToAddNewsFlash").hide();break;case t.addNews:$("#newsHeader").html("Send News");break;case t.newsItem:$("#newsHeader").html("News Item")}r&&r()})},s=function(){if(gdd.utils.isNative()){var t="";e.selectedItem.url()?t=e.selectedItem.tagLine()+" ("+e.selectedItem.url()+") - via Godochurch":t=e.selectedItem.tagLine()+" - via Godochurch",window.plugins.socialsharing.share(t)}else gdd.showMsg("Sharing is only available in the native version of this application, not the browser version.")},o=function(){if(e.selectedItem.url())if(gdd.utils.isNative())try{$(".btnNewsItemWebUrl").attr("href","#").removeAttr("target"),$(".btnNewsItemWebUrl").one(gdd.tap(),function(){try{var t=window.open(e.selectedItem.url(),"_system","location=yes,closebuttoncaption=Done/Close")}catch(n){alert("We cannot load the browser on this device: "+n)}}),$(".btnNewsItemWebUrl").show()}catch(n){alert("We cannot load the browser on this device: "+n)}else $(".btnNewsItemWebUrl").attr("href",e.selectedItem.url()).attr("target","_blank"),$(".btnNewsItemWebUrl").show();else $(".btnNewsItemWebUrl").hide();i(t.newsItem,"left")},u=function(){$(".newsFeedClick").off().on(gdd.click(),function(){a($(this).attr("data-id")),o()}),$(".btnNewsItemShareFromList").off().on(gdd.click(),function(){a($(this).attr("data-id")),s()}),$(".btnShareNewsItemFromFeed").off().on(gdd.tap(),function(){a($(this).attr("data-id")),s()}),$(".preNewsContent").show(),$(".newsBubbleCount").html(e.newsItems().length).show()},a=function(t){var n=$.grep(e.newsItems(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedItem,n[0])},f=function(t,i,s){$(".preNewsContent").hide(),$(".newsBubbleCount").html("").hide();var o=!1;e.newsItems().length===0&&(n=0,o=!0),s&&(o=!0),o?gdd.api.callApi("News/GetPersonsNewsFeed","GET",{personId:gdd.session.personId(),startRow:n,endRow:n+r},{success:function(r){$.each(r.gddData,function(t,n){e.newsItems.push(n),e.countries().indexOf(n.country)===-1&&e.countries.push(n.country),e.types().indexOf(n.type)===-1&&e.types.push(n.type)}),e.newsItems().length>0&&(u(),n=e.newsItems().length+1),$(".preNewsContent").show(),t()},fail:function(e){i(e.msg)}}):(u(),t())},l=function(){$("#btnTestLoadIMG").on("click",function(){var t=null,n=document.querySelector("#btnTESTIMGSelector").files[0],r=new FileReader;r.onloadend=function(){e.imgData=r.result,$("#imgNewsFlashPicture").prop("src",r.result),$("#newsImage").show()},n&&r.readAsDataURL(n)}),$("#btnNewsNewPhoto").on(gdd.click(),function(){$("#popupNewsPhotoSource").one("popupafterclose",function(t,n){var r={quality:49,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.CAMERA,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!0};navigator.camera.getPicture(function(t){try{t="data:image/jpeg;base64,"+t,e.imgData=t,$("#imgNewsFlashPicture").prop("src",t),$("#newsImage").show(),$("#btnNewsAddNativePhoto").hide()}catch(n){alert(JSON.stringify(n))}},function(e){alert(e)},r)}),$("#popupNewsPhotoSource").popup("close")}),$("#btnNewsExistingPhoto").on(gdd.click(),function(){$("#popupNewsPhotoSource").one("popupafterclose",function(t,n){var r={quality:49,destinationType:Camera.DestinationType.DATA_URL,sourceType:Camera.PictureSourceType.PHOTOLIBRARY,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,saveToPhotoAlbum:!0};navigator.camera.getPicture(function(t){t="data:image/jpeg;base64,"+t,e.imgData=t,$("#imgNewsFlashPicture").prop("src",t),$("#newsImage").show(),$("#btnNewsAddNativePhoto").hide()},function(e){alert(e)},r)}),$("#popupNewsPhotoSource").popup("close")}),$("#btnNewsAddNativePhoto").on(gdd.click(),function(){gdd.utils.isNative()?gdd.utils.isAndroid()?alert("This version of Android does not have the feature available to upload an image with a Newsflash."):gdd.showPopup("popupNewsPhotoSource",{positionTo:$(this)}):gdd.showMsg("To add a photo, you must be running this application as a native application from your phone.")}),$("#btnAddNewNewsFlash").on(gdd.tap(),function(){var n={};n.id=-1,n.content=$("#txtAddNewsContent").val(),n.channelId=$("#ddlAddNewsChooseChannel").val(),n.sendPush=!0,n.deleteMe=!1,n.imgUrl="";var r=function(){gdd.showLoader("Sending..."),gdd.api.callApi("News/UpdateNewsFlash","POST",n,{success:function(n){gdd.hideLoader(),e.imgData=null,$("#newsImage").hide(),$("#btnNewsAddNativePhoto").show(),$("#txtAddNewsContent").val(""),i(t.feed,"down",function(){$(".btnRefreshNewsFeeds").first().trigger(gdd.tap())})},fail:function(e){gdd.hideLoader(),alert(e.msg)}})},s=function(){gdd.showLoader("Uploading photo...");var t={};t.image=e.imgData,t.id=$("#ddlAddNewsChooseChannel").val(),t.instruction=1,gdd.api.callApi("Admin/UploadPhoto","POST",t,{success:function(t){gdd.hideLoader(),n.imgUrl=t.gddData,e.imgData=null,r()},fail:function(e){gdd.hideLoader(),alert(e.msg)}})};n.content?e.imgData?s():r():alert("You have not entered any content for this newsflash.")}),$(".btnAddNewsBackToNews").on(gdd.click(),function(){i(t.feed,"right")}),$("#btnNewsRemoveImage").on(gdd.click(),function(){e.imgData=null,$("#newsImage").hide(),$("#btnNewsAddNativePhoto").show()}),$(".btnGoToAddNewsFlash").on(gdd.click(),function(){var n=!1;try{n=gdd.session.activeSession.permissions.manageNewsItems}catch(r){n=!1}n?e.refData.channels().length===0?(gdd.showLoader("Loading channels..."),gdd.api.callApi("News/GetNewsData","GET","",{success:function(n){gdd.hideLoader(),n.gddData.channels.length===0?alert("This database has no news channels. Create one using the admin interface which will enable this feature in the mobile application."):(e.refData.channels.removeAll(),$.each(n.gddData.channels,function(t,n){e.refData.channels.push(n)}),e.refData.newsTypes.removeAll(),$.each(n.gddData.newsTypes,function(t,n){e.refData.newsTypes.push(n)}),i(t.addNews,"left"))},fail:function(e){gdd.hideLoader(),alert(e.msg)}})):i(t.addNews,"left"):gdd.utils.requestPermission("Request permission to send news to subscribers from mobile application.")}),$("#btnNewsItemShare2").on(gdd.click(),function(){s()}),$(".btnGoToSubs").on(gdd.click(),function(){gdd.loadPage(gdd.pages.subs,!1,"slide")}),$(".btnNewsItemBackToFeed").on(gdd.click(),function(){i(t.feed,"right")}),$(".btnGoTemp").off().on(gdd.tap(),function(){alert("Launch Module")}),$(".btnRefreshNewsFeeds").on(gdd.tap(),function(){e.newsItems.removeAll(),gdd.showLoader("Refreshing..."),f(function(){e.newsItems().length===0?i(t.noNews,"left"):i(t.feed,"left"),gdd.hideLoader()},function(e){gdd.hideLoader(),alert(e)})}),$("#btnLoadMoreNewsItems").on(gdd.tap(),function(){gdd.showLoader("Loading more..."),f(function(){e.newsItems().length===0?i(t.noNews,"left"):i(t.feed,"left"),gdd.hideLoader()},function(e){gdd.hideLoader(),alert(e)},!0)})};return{imgData:null,selectedItem:{target:ko.observable(""),publishStart:ko.observable(""),publishEnd:ko.observable(""),forNews:ko.observable(!1),forPrayer:ko.observable(!0),headerUrl:ko.observable(""),feedImgUrl:ko.observable(""),id:ko.observable(-1),title:ko.observable(""),content:ko.observable(""),country:ko.observable(""),type:ko.observable(""),headerImgUrl:ko.observable(""),headerVideoUrl:ko.observable(""),displayHeader:ko.observable(!0),channelName:ko.observable(""),channelDescription:ko.observable(""),channelId:ko.observable(""),portalId:ko.observable(""),portalName:ko.observable(""),url:ko.observable(""),headerIsImage:ko.observable(!0),tagLine:ko.observable("")},newsItems:ko.observableArray(),countries:ko.observableArray(),types:ko.observableArray(),refData:{channels:ko.observableArray(),newsTypes:ko.observableArray()},create:function(){e=this,gdd.utils.configMergeFromJs(ko),l(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){$("#idxContent").show(),gdd.showLoader("Loading news..."),f(function(){e.newsItems().length===0?i(t.noNews,"left"):i(t.feed,"left"),gdd.hideLoader()},function(e){gdd.hideLoader(),alert(e)})},beforeShow:function(){},beforeHide:function(){i(t.feed,"left")},endOldSession:function(){gdd.pages.news.view.refData.channels.removeAll()}}}),define("views/subs",[],function(){var e=null,t={all:".subsView",none:".subsNone",active:".subsActive",inactive:".subsInActive"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.none:$("#subsHeader").html("Subscriptions");break;case t.active:$("#subsHeader").html("Active Subs");break;case t.inactive:$("#subsHeader").html("Subscribe")}r&&r()})},r=function(){$("#btnViewInActiveSubs").on(gdd.tap(),function(){n(t.inactive,"left")}),$("#btnViewActiveSubs").on(gdd.tap(),function(){n(t.active,"right")}),$("#btnWhereIsMyChurch").on(gdd.tap(),function(){gdd.showPopup("popupAddMyChurchNews")}),$("#btnSubsRefresh").on(gdd.click(),function(){e.subs.removeAll(),gdd.showLoader("Loading subscriptions..."),i(function(){gdd.hideLoader(),s()},function(e){gdd.hideLoader(),gdd.showErr(e)})})},i=function(r,i){var s=function(){$(".channelSubsFlipSwtch").flipswitch(),$(".channelSubsFlipSwtch").flipswitch("refresh");var i=function(t,n,r,i){gdd.showLoader(i);var s={};s.personId=gdd.session.personId(),s.subscribed=n,s.sendEmail=r,s.channelId=t,gdd.api.callApi("News/UpdatePersonsChannelSubscription","POST",s,{success:function(r){gdd.hideLoader(),gdd.pages.news.view.newsItems.removeAll(),$.each(e.subs(),function(e,r){$.each(r.channels,function(e,r){r.channelId==t&&(r.subscribed=n)})})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})};$(".btnSubscribeToPortal").on(gdd.click(),function(){var r=$(this).attr("data-id"),i=$.grep(e.subs(),function(e,t){return e.portalId==r});i[0].hasSub=!0,e.subs.splice(e.subs.indexOf(i[0]),1,i[0]),s(),n(t.active,"right")}),$(".channelSubsFlipSwtch").on("change",function(){var e=$(this).attr("data-id"),t=$(this).prop("checked");t?i(e,!0,!1,"Subscribing..."):i(e,!1,!1,"Unsubscribing...")}),r()},o=!1;e.subs().length===0&&(o=!0),o?gdd.api.callApi("News/GetPersonsNewsSubsProfile","GET",{personId:gdd.session.personId},{success:function(t){e.subs.removeAll();var n=t.gddData;$.each(n,function(t,n){e.subs.push(n)}),s()},fail:function(e){i(e.msg)}}):(s(),r())},s=function(){if(e.subs().length===0)n(t.none,"up");else{var r=!1;$.each(e.subs(),function(e,t){t.hasSub&&(r=!0)}),r?n(t.active,"up"):n(t.inactive,"up")}};return{subs:ko.observableArray(),create:function(){e=this,gdd.utils.configMergeFromJs(ko),r(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){gdd.showLoader("Loading subscriptions..."),i(function(){gdd.hideLoader(),s()},function(e){gdd.hideLoader(),gdd.showErr(e)})},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.subs.view.subs.removeAll()}}}),define("views/people",[],function(){var e=null,t={all:".peopleView",addNew:".peopleAddNewView",search:".peopleSearchView",duplicates:".peopleDuplicateView",selectedPerson:".selectedPersonView"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.addNew:$("#peopleHeader").html("Add New");break;case t.search:$("#peopleHeader").html("Search");break;case t.duplicates:$("#peopleHeader").html("Duplicates?");break;case t.selectedPerson:$("#peopleHeader").html("Person")}r&&r()})},r=function(){$(".btnPeopleSearchView").off().on(gdd.tap(),function(){var r=$(this).attr("data-id"),i=$.grep(e.people(),function(e,t){return e.id==r});e.selectedPerson.id(i[0].id),e.selectedPerson.firstName(i[0].firstName),e.selectedPerson.lastName(i[0].lastName),e.selectedPerson.email(i[0].email),e.selectedPerson.mobileNumber(i[0].mobileNumber),e.selectedPerson.fbId(i[0].facebookId),e.selectedPerson.fbPicUrl("https://graph.facebook.com/"+i[0].facebookId+"/picture?type=large"),$(".selectedPersonViewBack").one(gdd.tap(),function(){n(t.search,"right")}),$("#selectPersonText").html("Select this person"),n(t.selectedPerson,"left")}),$(".btnPeopleSearchSelect").off().on(gdd.tap(),function(){var r=$(this).attr("data-id"),i=$.grep(e.people(),function(e,t){return e.id==r});e.selectedPerson.id(i[0].id),e.selectedPerson.firstName(i[0].firstName),e.selectedPerson.lastName(i[0].lastName),e.selectedPerson.email(i[0].email),e.selectedPerson.mobileNumber(i[0].mobileNumber),e.selectedPerson.fbId(i[0].facebookId),e.selectedPerson.fbPicUrl("https://graph.facebook.com/"+i[0].facebookId+"/picture?type=large"),gdd.pages.people.view.clb?(gdd.pages.people.view.clb(ko.mapping.toJS(e.selectedPerson)),gdd.pages.people.view.clb=null):($(".selectedPersonViewBack").one(gdd.tap(),function(){n(t.search,"right")}),$("#selectPersonText").html("Select this person"),n(t.selectedPerson,"left"))})},i=function(){$("#btnPeopleMapExisting").on(gdd.click(),function(r){gdd.showLoader("Working..."),gdd.api.callApi("Person/MapPerson","GET",{personId:e.selectedPerson.id()},{success:function(r){gdd.hideLoader(),e.clb?(e.clb(ko.mapping.toJS(e.selectedPerson)),e.clb=null):n(t.search,"right")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#btnDuplicateNotHere").on(gdd.tap(),function(){e.newPerson.skipDupCheck("1"),s(function(r){e.selectedPerson.id(r.id),e.selectedPerson.firstName(r.firstName),e.selectedPerson.lastName(r.lastName),e.selectedPerson.email(r.email1),e.selectedPerson.mobileNumber(r.mobileNumber),e.selectedPerson.fbId(r.facebookId),e.selectedPerson.fbPicUrl(r.facebookProfilePicLg),e.clb?e.clb(ko.mapping.toJS(e.selectedPerson)):n(t.search,"right")},function(e){n(t.duplicates,"left",function(){gdd.showPopup("popupDupFound")})},function(e){gdd.showErr(e)})}),$(".peopleDupViewBack").on(gdd.tap(),function(){n(t.addNew,"right")}),$("#btnPersonBackToAdd").on(gdd.tap(),function(){n(t.addNew,"right")}),$("#btnAddPerson").on(gdd.tap(),function(){e.newPerson.skipDupCheck("0"),s(function(t){e.selectedPerson.id(t.id),e.selectedPerson.firstName(t.firstName),e.selectedPerson.lastName(t.lastName),e.selectedPerson.email(t.email1),e.selectedPerson.mobileNumber(t.mobileNumber),e.selectedPerson.fbId(t.facebookId),e.selectedPerson.fbPicUrl(t.facebookProfilePicLg),e.clb(ko.mapping.toJS(e.selectedPerson))},function(e){n(t.duplicates,"left",function(){gdd.showPopup("popupDupFound")})},function(e){gdd.showErr(e)})}),$(".btnAddNewPerson").on(gdd.tap(),function(){n(t.addNew,"up")}),$(".btnSearchPerson").on(gdd.tap(),function(){n(t.search,"down")}),$("#peopleList").on("filterablebeforefilter",function(t,n){var i=$(this),s=$(n.input),o=s.val(),u={};u.scopeGlobal=!1,u.scopeOrg=!1,u.searchString=o,o&&o.length>2&&(gdd.showLoader("Searching..."),gdd.api.callApi("Person/QuickSearch","POST",u,{success:function(t){gdd.hideLoader();var n=t.gddData;e.people.removeAll(),$.each(n,function(t,n){e.people.push(n)}),i.listview("refresh"),i.trigger("updatelayout"),r()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))})},s=function(r,i,s){var o=ko.mapping.toJS(e.newPerson);o.firstName&&o.lastName?!o.email1&&!o.mobileNumber?gdd.showMsg("You provide either a mobile number or email address or both."):(gdd.showLoader("Adding..."),gdd.api.callApi("Person/AddPerson","POST",ko.mapping.toJS(e.newPerson),{success:function(s){gdd.hideLoader(),s.gddData.resultCode=="1"?r(s.gddData.results[0]):(e.duplicates.removeAll(),$.each(s.gddData.results,function(t,n){e.duplicates.push(n)}),$(".selectDuplicate").off().on(gdd.tap(),function(){var r=$(this).attr("data-id"),i=$.grep(e.duplicates(),function(e,t){return e.id==r});e.selectedPerson.id(i[0].id),e.selectedPerson.firstName(i[0].firstName),e.selectedPerson.lastName(i[0].lastName),e.selectedPerson.email(i[0].email1),e.selectedPerson.mobileNumber(i[0].mobileNumber),e.selectedPerson.fbId(i[0].facebookId),e.selectedPerson.fbPicUrl(i[0].facebookProfilePicLg),$(".selectedPersonViewBack").one(gdd.tap(),function(){n(t.duplicates,"right")}),$("#selectPersonText").html("This is the person"),n(t.selectedPerson,"left")}),$("#peopleDuplicateList").listview("refresh"),i())},fail:function(e){gdd.hideLoader(),s(e.msg)}})):gdd.showMsg("You must provide both a first and last name.")};return{duplicates:ko.observableArray(),newPerson:{id:ko.observable("-1"),firstName:ko.observable(""),lastName:ko.observable(""),mobileNumber:ko.observable(""),email1:ko.observable(""),skipDupCheck:ko.observable("0")},clb:null,selectedPerson:{id:ko.observable(""),firstName:ko.observable(""),lastName:ko.observable(""),email:ko.observable(""),mobileNumber:ko.observable(""),fbId:ko.observable(""),fbPicUrl:ko.observable("")},people:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),i(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){e.people().length>0&&($("#peopleList").listview("refresh"),$("#peopleList").trigger("updatelayout"),r())},beforeShow:function(){},beforeHide:function(){gdd.pages.people.clb=null},endOldSession:function(){gdd.pages.people.view.people.removeAll(),gdd.pages.people.view.duplicates.removeAll()}}}),define("views/groups",[],function(){var e=null,t=null,n=null,r={all:".grpView",grpList:".grpList",grpEdit1:".grpEdit1",grpEdit2:".grpEdit2",grpEdit3:".grpEdit3",grpEdit4:".grpEdit4",grpMembers:".grpMembers",grpMemDeActivate:".grpMemDeActivate",grpSessions:".grpSessions",grpSessionEdit:".grpSessionEdit",grpSessionAtt:".grpSessionAtt",grpDeActivate:".grpDeActivate",grpSearch:".grpSearch",grpSearchResults:".grpSearchResults"},i=null,s=null,o=function(t,n,i){gdd.utils.slideTransitionView($(r.all),$(t),n,function(){$("select").selectmenu(),$("select").selectmenu("refresh");switch(t){case r.grpList:$("#grpHeaderText").html("Groups"),e.groups().length>0?$("#grpsNone").hide():$("#grpsNone").show();break;case r.grpEdit1:$("#grpHeaderText").html("1 of 4");break;case r.grpSearch:$("#grpHeaderText").html("Search");break;case r.grpSearchResults:$("#grpHeaderText").html("Results");break;case r.grpEdit2:$("#grpHeaderText").html("2 of 4"),e.selectedGroup.geoLat()?$(".grpEdit2GoTo4").show():$(".grpEdit2GoTo4").hide();break;case r.grpEdit3:$("#grpHeaderText").html("3 of 4"),gdd.session.activeSession.portalSettings.allowGroupStreetAddresses?($("#grpEditShowStreetInfo").show(),$("#grpEditHideStreetInfo").hide()):($("#grpEditShowStreetInfo").hide(),$("#grpEditHideStreetInfo").show()),e.selectedGroup.suburb()?$("#grpEditSuburb").hide():$("#grpEditSuburb").show();break;case r.grpEdit4:$("#grpHeaderText").html("4 of 4");break;case r.grpMembers:$("#grpHeaderText").html("Members");break;case r.grpMemDeActivate:$("#grpHeaderText").html("DeActivate"),gdd.session.activeSession.portalSettings.allowGroupMemberDelete?$("#btnDeleteMemberForever").show():$("#btnDeleteMemberForever").hide();break;case r.grpSessions:$("#grpHeaderText").html("Sessions");break;case r.grpSessionEdit:$("#grpHeaderText").html("Edit"),e.selectedGroupSession.id()<0?$("#btnGrpDeleteSession").hide():$("#btnGrpDeleteSession").show();break;case r.grpSessionAtt:$("#grpHeaderText").html("Attendance");break;case r.grpDeActivate:$("#grpHeaderText").html("DeActivate")}i&&i()})},u=function(){e.refData.typesAllowed().length===0?gdd.utils.requestPermission("Request permission to add a group."):(e.selectedGroup.groupTypeId(e.refData.typesAllowed()[0].typeId),e.selectedGroup.groupType(e.refData.typesAllowed()[0].typeName),e.selectedGroup.categoryId(e.refData.typesAllowed()[0].catId),e.selectedGroup.categoryName(e.refData.typesAllowed()[0].catName),e.selectedGroup.leaderId(gdd.session.personId()),e.selectedGroup.id(-1),e.selectedGroup.gender("M/F"),e.selectedGroup.meetingDay("Unknown"),e.selectedGroup.meetingTime(""),e.selectedGroup.meetingFrequency("Weekly"),e.selectedGroup.groupName(""),e.selectedGroup.groupDescription(""),e.selectedGroup.geoLocationId(-1),e.selectedGroup.geoLat(null),e.selectedGroup.geoLng(null),e.selectedGroup.ageProfileId(e.refData.ageProfiles()[0].id),e.selectedGroup.ageProfile(e.refData.ageProfiles()[0].name),e.selectedGroup.isActive(!0),e.selectedGroup.isPrivate(!1),e.selectedGroup.openMembership(!0),e.selectedGroup.members.removeAll(),e.selectedGroup.sessions.removeAll(),e.selectedGroup.regionId(e.refData.regions()[0].id),e.selectedGroup.regionName(e.refData.regions()[0].name),o(r.grpEdit1,"left"))},a=function(){if(e.refData.typesAllowed().length===0)gdd.utils.requestPermission("Request permission to edit groups.");else{var t=$.grep(e.refData.typesAllowed(),function(t,n){return t.typeId==e.selectedGroup.groupTypeId});t.length===0&&(e.selectedGroup.groupTypeId(e.refData.typesAllowed()[0].typeId),e.selectedGroup.groupType(e.refData.typesAllowed()[0].typeName),e.selectedGroup.categoryId(e.refData.typesAllowed()[0].catId),e.selectedGroup.categoryName(e.refData.typesAllowed()[0].catName)),$.when($(r.all).hide("slide",{direction:"left"})).then(function(){$(r.grpEdit1).show("slide",{direction:"right"})})}},f=function(t,n){if(e.groups().length>0)l(),t();else{var r={};r.leaderId=gdd.session.personId(),gdd.api.callApi("Groups/SearchGroups","POST",r,{success:function(n){e.groups.removeAll(),$.each(n.gddData,function(t,n){e.groups.push(n)}),l(),t()},fail:function(e){n(e.msg)}})}},l=function(){$(".grpListCollSet").collapsibleset("refresh");var t=function(t){if(t!=e.selectedGroup.id()){e.selectedGroup.sessions.removeAll(),e.selectedGroup.members.removeAll();var n=$.grep(e.groups(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedGroup,ko.mapping.toJS(n[0]))}};$(".btnGroupMenu").off().on(gdd.click(),function(){t($(this).attr("data-id")),gdd.showPopup("popupGrpMenu")}),$(".btnActivateGroup").off().on(gdd.tap(),function(){t($(this).attr("data-id")),e.selectedGroup.isActive(!0),a()})},c=function(){e.selectedGroupSession.attendance.removeAll(),$.each(e.groups,function(e,t){t.sessions&&$.each(t.sessions,function(e,t){t.attendance&&(t.attendance.length=0)})})},h=function(t){t||(t=r.grpList),e.selectedGroup.members().length>0?(d(),o(r.grpMembers,"up",function(){$(".grpMembersBack").off().one(gdd.tap(),function(){o(t,"down")})})):(gdd.showLoader("Loading members..."),E(function(){gdd.hideLoader(),d(),o(r.grpMembers,"up",function(){$(".grpMembersBack").off().one(gdd.tap(),function(){o(t,"down")})})},function(e){gdd.hideLoader(),gdd.showErr(e)}))},p=function(){e.selectedGroup.sessions().length>0?(o(r.grpSessions,"down",function(){$(".grpSessionsBack").off().on(gdd.tap(),function(){o(r.grpList,"right")})}),v()):(gdd.showLoader("Loading sessions..."),gdd.api.callApi("Groups/GetGroupsSessions","GET",{groupId:e.selectedGroup.id()},{success:function(t){gdd.hideLoader(),e.selectedGroup.sessions.removeAll();var n=e.selectedGroup.sourceRecord();n.sessions||(n.sessions=new Array),n.sessions.length=0,$.each(t.gddData,function(t,r){n.sessions.push(r),e.selectedGroup.sessions.push(r)}),v(),e.selectedGroup.sessions().length===0?gdd.showMsg("Let's add your first session for this group.",function(){m(),$(".grpSessionsBack").off().on(gdd.tap(),function(){o(r.grpList,"right")})}):o(r.grpSessions,"down",function(){$(".grpSessionsBack").off().on(gdd.tap(),function(){o(r.grpList,"right")})})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))},d=function(){var t=function(t){var n=$.grep(e.selectedGroup.members(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedGroupMember,ko.mapping.toJS(n[0]))};$(".memberDelete").off().on(gdd.click(),function(){t($(this).attr("data-id")),e.selectedGroupMember.personId()==e.selectedGroup.leaderId()?gdd.showMsg("You cannot de-activate the leader of the group."):o(r.grpMemDeActivate,"up",function(){$(".grpMemDeActivateBack").off().one(gdd.tap(),function(){o(r.grpMembers,"down")})})}),$(".memberActivate").off().on(gdd.click(),function(){t($(this).attr("data-id")),gdd.showLoader("Activating..."),S(e.selectedGroupMember.personId(),e.selectedGroup.id(),!0,"","",function(e){gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)})})},v=function(){var t=function(t){var n=$.grep(e.selectedGroup.sessions(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedGroupSession,ko.mapping.toJS(n[0]))};$(".btnGrpSessionEdit").off().on(gdd.click(),function(){t($(this).attr("data-id")),o(r.grpSessionEdit,"up",function(){$(".grpSessionEditBack").off().one(gdd.tap(),function(){o(r.grpSessions,"down")})})}),$(".btnGrpSessionRegister").off().on(gdd.tap(),function(){var n=$(this).attr("data-id");n!=e.selectedGroupSession.id()&&(e.selectedGroupSession.attendance.removeAll(),t(n)),b()})},m=function(){var t=gdd.utils.getDt();e.selectedGroupSession.id(-1),e.selectedGroupSession.name(""),e.selectedGroupSession.moreInfo(""),e.selectedGroupSession.unixSessionDate(t.unix),e.selectedGroupSession.sessionDateDisplay(t.display),e.selectedGroupSession.groupId(e.selectedGroup.id()),e.selectedGroupSession.attendance.removeAll(),o(r.grpSessionEdit,"up",function(){$(".grpSessionEditBack").off().one(gdd.tap(),function(){o(r.grpSessions,"down")})})},g=function(t,n){if(e.refData.groupMeetingFrequencies().length>0)t();else{var r=function(n){var r=gdd.permissions().secLevel;e.refData.categories.removeAll(),e.refData.typesAllowed.removeAll();var i=new Array;$.each(n.groupCategories,function(t,n){e.refData.categories.push(n),r>=n.editMinSecLevel&&$.each(n.types,function(e,t){if(r>=t.editMinSecLevel){var s={};s.typeId=t.id,s.typeName=t.name,s.name=t.name,s.catId=t.categoryId,s.catName=n.name,s.description=t.description,s.editLabel=t.mobileAppAssignLabel,i.push(s)}})}),i.sort(function(t,n){return t.name<n.name?-1:t.name>n.name?1:0}),$.each(i,function(t,n){e.refData.typesAllowed.push(n)}),e.refData.suburbs.removeAll(),$.each(n.groupSuburbs,function(t,n){e.refData.suburbs.push(n)}),e.refData.ageProfiles.removeAll(),$.each(n.ageProfiles,function(t,n){e.refData.ageProfiles.push(n)}),e.refData.regions.removeAll(),$.each(n.regions,function(t,n){n.targetGrps&&e.refData.regions.push(n)}),e.refData.groupsInActiveReasons.removeAll(),$.each(n.groupsInActiveReasons,function(t,n){e.refData.groupsInActiveReasons.push(n)}),e.refData.groupMeetingFrequencies.removeAll(),$.each(n.groupMeetingFrequencies,function(t,n){e.refData.groupMeetingFrequencies.push(n)}),e.refData.groupMembersInActiveReasons.removeAll(),$.each(n.groupMembersInActiveReasons,function(t,n){e.refData.groupMembersInActiveReasons.push(n)}),t()},i={};i.groupCategories="1",i.ageProfiles="1",i.groupSuburbs="1",i.groupsInActiveReasons="1",i.groupMembersInActiveReasons="1",i.regions="1",i.groupNamingConventions="1",i.groupMeetingFrequency="1";var s=!1,o=gdd.storage.getGrpRefData()||new Array;if(o)try{o.groupCategories.length>0&&o.groupMeetingFrequencies.length>0&&o.groupNamingConventions.length>0&&o.regions.length>0&&o.ageProfiles.length>0&&o.groupSuburbs.length>0&&o.groupsInActiveReasons.length>0&&o.groupMembersInActiveReasons.length>0?(s=!1,r(o)):s=!0}catch(u){s=!0}else s=!0;s&&gdd.api.callApi("RefData/GetRefData","POST",i,{success:function(e){gdd.storage.saveGrpRefData(e.gddData),r(e.gddData)},fail:function(e){n(e.msg)}})}},y=function(){$(".grpAttendanceList").listview("refresh"),$(".grpSessionAttFlipSwtch").flipswitch(),$(".grpSessionAttFlipSwtch").flipswitch("refresh"),$(".grpSessionAttFlipSwtch").off().on("change",function(t){var n=$(this).attr("data-id"),r=$.grep(e.selectedGroupSession.attendance(),function(e,t){return e.id==n});ko.mapping.mergeFromJS(e.selectedSessionAttendanceRecord,r[0]);var i=null;$(this).is(":checked")?i=!0:i=!1,gdd.showLoader("Working..."),gdd.api.callApi("Groups/UpdateGroupsSessionAttendance","GET",{sessionId:e.selectedGroupSession.id(),personId:e.selectedSessionAttendanceRecord.personId(),attended:i},{success:function(t){gdd.hideLoader();var n=$.grep(e.selectedGroupSession.attendance(),function(t,n){return t.id==e.selectedSessionAttendanceRecord.id()});n[0].attended=i},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})})},b=function(){e.selectedGroupSession.attendance().length>0?(y(),o(r.grpSessionAtt,"up",function(){$(".grpSessionAttBack").off().one(gdd.tap(),function(){p()})})):(gdd.showLoader("Loading..."),gdd.api.callApi("Groups/GetSessionAttendanceRegister","GET",{sessionId:e.selectedGroupSession.id()},{success:function(t){gdd.hideLoader(),$.each(t.gddData,function(t,n){e.selectedGroupSession.attendance.push(n)}),y(),o(r.grpSessionAtt,"up",function(){$(".grpSessionAttBack").off().one(gdd.tap(),function(){p()})})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))},w=function(t,n){var r=ko.mapping.toJS(e.selectedGroup);gdd.api.callApi("Groups/UpdateGroup","POST",r,{success:function(n){gdd.hideLoader();var r=n.gddData[0],i=$.grep(e.groups(),function(e,t){return e.id==r.id}),s=0;i.length>0&&(s=e.groups.indexOf(i[0]),e.groups.splice(s,1)),e.groups.splice(s,0,r),l(),t()},fail:function(e){n(e.msg)}})},E=function(t,n){e.selectedGroup.members().length>0?t():gdd.api.callApi("Groups/GetGroupMembers","GET",{groupId:e.selectedGroup.id()},{success:function(n){e.selectedGroup.members.removeAll();var r=e.selectedGroup.sourceRecord();r.members||(r.members=new Array),r.members.length=0,$.each(n.gddData,function(t,n){e.selectedGroup.members.push(n),r.members.push(n)}),t()},fail:function(e){n(e.msg)}})},S=function(t,n,r,i,s,o,u){var a={};a.personId=t,a.groupId=n,a.isActive=r,a.inActiveReasonId=i,a.moreInfo=s,gdd.api.callApi("Groups/UpdateGroupMemberStatus","POST",a,{success:function(t){var n=t.gddData[0],r=$.grep(e.selectedGroup.members(),function(e,t){var r=!1;return e.id==n.id?r=!0:e.personId==n.personId&&(r=!0),r}),i=0;r.length>0&&$.each(r,function(t,n){i=e.selectedGroup.members.indexOf(n),e.selectedGroup.members.splice(i,1)}),e.selectedGroup.members.splice(i,0,n),$(".membersListView").listview("refresh"),d(),e.selectedGroupSession.attendance.removeAll(),$.each(e.groups,function(e,t){t.sessions&&$.each(t.sessions,function(e,t){t.attendance&&(t.attendance.length=0)})}),o()},fail:function(e){u(e.msg)}})},x=function(){$(".grpSearchCollSet").collapsibleset("refresh");var t=function(t){var n=$.grep(e.loadedGroups(),function(e,n){return e.id==t});n.length>0&&(e.selectedGroup=n[0])};$(".groupSearchItem").off().on(gdd.click(),function(n){$("#grpSearchErr").hide(),t($(this).attr("data-id"));switch(e.searchReason){case 1:$("#grpSearchResultsActions").popup("open",{transition:"slideup"});break;case 2:e.callBackFunction(e.selectedGroup),gdd.app.loadPage(e.callingPage,{transition:"flip",reverse:"true"});break;case 3:gdd.app.showGlbMsg("Thank You","<p>Please give the person the information needed to contact the group leader.<p/><p>In a weeks time please confirm that they were able to contact the leader.</p><p>When you are done click the 'tick' button on the top of the screen.</p>")}})},T=function(){$("#btnGrpSearchMapView").on(gdd.tap(),function(){var n=new Array,r="";$.each(e.searchedGroups(),function(e,t){r='<div style="width:200px; height:150px" ><strong>'+t.groupName+"</strong>",r+='<table width="100%">',r+="<tr><td>Leader</td><td>"+t.leaderName+"</td></tr>",r+="<tr><td>Tel</td><td>"+t.leaderMobileNumber+"</td></tr>",r+="<tr><td>Day</td><td>"+t.meetingDay+"</td></tr>",r+="</table></div>",n.push({lat:t.geoLat,lng:t.geoLng,pinColor:"red",content:r})}),t=1,gdd.pages.gmap.view.configureForDropPins(n),gdd.loadPage(gdd.pages.gmap,!1,"slideup")}),$("#btnGrpSearchReset").on(gdd.tap(),function(){e.grpQry.ageProfileId(undefined),e.grpQry.regionId(undefined),e.grpQry.categoryId(""),e.grpQry.groupTypeId(""),e.grpQry.gender(""),e.grpQry.meetingDay(""),e.grpQry.suburb(undefined),e.grpQry.restrictToPortal(!0),e.grpQry.isActive(1),e.grpQry.matchAll(!0),$("select").selectmenu("refresh")}),$(".grpSearchResultsBack").on(gdd.tap(),function(){o(r.grpSearch,"right")}),$("#btnGrpSearch").on(gdd.tap(),function(){o(r.grpSearch,"up")}),$(".btnAddNewGroup").on(gdd.click(),function(){u()}),$(".grpEdit1Back").on(gdd.click(),function(){o(r.grpList,"right")}),$(".grpEdit1Next").on(gdd.click(),function(){e.selectedGroup.groupName()&&e.selectedGroup.groupDescription()?o(r.grpEdit2,"left"):gdd.showMsg("Please ensure you have entered a name for the group and given a brief description about the group. e.g. Mens discipleship.")}),$(".grpEditCancel").on(gdd.click(),function(){o(r.grpList,"right")}),$(".grpEdit2Back").on(gdd.click(),function(){o(r.grpEdit1,"right")}),$(".grpEdit2Next").on(gdd.click(),function(){gdd.pages.gmap.view.configurePageForAddressEdit(function(t){n=!0,e.selectedGroup.streetNumber(t.streetNumber),e.selectedGroup.streetName(t.streetName),e.selectedGroup.geoLat(t.geoLat),e.selectedGroup.geoLng(t.geoLng),e.selectedGroup.area(t.area),e.selectedGroup.city(t.city),e.selectedGroup.country(t.country),e.selectedGroup.postalCode(t.postalCode),e.selectedGroup.region(t.streetName),e.selectedGroup.suburb(t.suburb),e.selectedGroup.geoAddress(t.formatted_address)},gdd.pages.groups,e.selectedGroup.geoLat(),e.selectedGroup.geoLng(),1),gdd.utils.loadPage(gdd.pages.gmap,!1,"slideup")}),$(".grpEdit3Back ").on(gdd.click(),function(){o(r.grpEdit2,"right")}),$(".grpEdit3Next").on(gdd.click(),function(){o(r.grpEdit4,"left")}),$(".grpEdit4Back").on(gdd.click(),function(){o(r.grpEdit2,"right")}),$("#grpEdit4Save").on(gdd.click(),function(){gdd.showLoader("Updating..."),w(function(){gdd.hideLoader(),o(r.grpList,"left")},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$(".grpEdit2GoTo4").on(gdd.click(),function(){o(r.grpEdit4,"left")}),$("#btnGrpEdit").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(e,t){a()}),$("#popupGrpMenu").popup("close")}),$("#btnGrpViewMembers").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(e,t){h()}),$("#popupGrpMenu").popup("close")}),$("#btnDeleteMemberForever").on(gdd.click(),function(){gdd.showPopup("memberDeletePopup")}),$("#btnMemberConfirmDelete").on(gdd.click(),function(){$("#memberDeletePopup").one("popupafterclose",function(t,n){gdd.showLoader("Deleting..."),gdd.api.callApi("Groups/DeleteMemberFromGroup","GET",{memberId:e.selectedGroupMember.personId(),groupId:e.selectedGroup.id()},{success:function(t){gdd.hideLoader();var n=$.grep(e.selectedGroup.members(),function(t,n){return t.personId==e.selectedGroupMember.personId()});e.selectedGroup.members.splice(e.selectedGroup.members.indexOf(n[0]),1),o(r.grpMembers,"up"),c()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#memberDeletePopup").popup("close")}),$("#btnGrpDeActivateMemGo").on(gdd.click(),function(){if(e.selectedGroupMember.personId()==e.selectedGroup.leaderId())gdd.showMsg("You cannot de-activate the leader of the group.");else{var t=$("#ddlGrpMemDeActiveReason").val(),n=$("#grpMemDeActivateMoreInfo").val();t&&n?(gdd.showLoader("De-Activating..."),S(e.selectedGroupMember.personId(),e.selectedGroup.id(),!1,t,n,function(e){gdd.hideLoader(),o(r.grpMembers,"up")},function(e){gdd.hideLoader(),gdd.showErr(e)})):gdd.showMsg("Please provide the reason why you are de-activating this person from the group.")}}),$("#popupGrpMenu").on("popupbeforeposition",function(e,t){gdd.session.activeSession.portalSettings.allowGroupDelete?$("#btnDeleteGroup").show():$("#btnDeleteGroup").hide()}),$("#btnGrpAttendance").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(e,t){gdd.showLoader("Loading members..."),E(function(){gdd.hideLoader(),p()},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$("#popupGrpMenu").popup("close")}),$("#btnUpdateGrpSession").on(gdd.tap(),function(){e.selectedGroupSession.name()?e.selectedGroupSession.unixSessionDate()?(gdd.showLoader("Updating..."),gdd.api.callApi("Groups/UpdateGroupsSession","POST",ko.mapping.toJS(e.selectedGroupSession),{success:function(t){gdd.hideLoader();var n=0,i=$.grep(e.selectedGroup.sessions(),function(e,n){return e.id==t.gddData[0].id});i.length>0&&(n=e.selectedGroup.sessions.indexOf(i[0]),e.selectedGroup.sessions.splice(n,1)),e.selectedGroup.sessions.splice(n,0,t.gddData[0]);var s=e.selectedGroup.sourceRecord(),u=$.grep(s.sessions,function(e,n){return e.id==t.gddData[0].id});u.length>0&&(n=s.sessions.indexOf(i[0]),s.sessions.splice(n,1)),s.sessions.splice(n,0,t.gddData[0]),v(),o(r.grpSessions,"down")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})):gdd.showMsg("Please provide a session date"):gdd.showMsg("Please provide a session name")}),$("#btnAddGroupSession").on(gdd.tap(),function(){m()}),$("#btnManageMembers").on(gdd.tap(),function(){h(r.grpSessions)}),$("#btnGrpDeleteYes").on(gdd.tap(),function(){$("#grpDeletePopup").one("popupafterclose",function(t,n){gdd.showLoader("Deleting group..."),gdd.api.callApi("Groups/DeleteGroup","GET",{groupId:e.selectedGroup.id()},{success:function(t){gdd.hideLoader();var n=$.grep(e.groups(),function(t,n){return t.id==e.selectedGroup.id()});e.groups.splice(e.groups.indexOf(n[0]),1)},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#grpDeletePopup").popup("close")}),$("#btnDeleteGroup").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(e,t){gdd.showPopup("grpDeletePopup")}),$("#popupGrpMenu").popup("close")}),$("#btnGrpDeActivateMi").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(e,t){o(r.grpDeActivate,"up",function(){$(".grpDeActivateBack").off().one(gdd.tap(),function(){o(r.grpList,"down")})})}),$("#popupGrpMenu").popup("close")}),$("#btnDeActivateGroup").on(gdd.tap(),function(){var t=$("#ddlGrpDeActiveReason").val(),n=$("#grpDeActivateMoreInfo").val();n?(e.selectedGroup.stsReasonId(t),e.selectedGroup.stsMoreInfo(n),e.selectedGroup.isActive(!1),gdd.showLoader("De-Activating..."),w(function(){gdd.hideLoader(),o(r.grpList,"down")},function(e){gdd.hideLoader(),gdd.showErr(e)})):gdd.showMsg("Please give us a little more info why you are de-activating this group.")}),$("#btnGrpDeleteSession").on(gdd.tap(),function(){gdd.showLoader("Deleting..."),gdd.api.callApi("Groups/DeleteGroupSession","GET",{sessionId:e.selectedGroupSession.id()},{success:function(t){gdd.hideLoader();var n=$.grep(e.selectedGroup.sessions(),function(t,n){return t.id==e.selectedGroupSession.id()});e.selectedGroup.sessions.splice(e.selectedGroup.sessions.indexOf(n[0]),1);var i=e.selectedGroup.sourceRecord(),s=$.grep(i.sessions,function(t,n){return t.id==e.selectedGroupSession.id()});i.sessions.splice(i.sessions.indexOf(n[0]),1),e.selectedGroup.sessions().length===0?o(r.grpList,"down"):o(r.grpSessions,"down")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$(".btnAddNewMember").on(gdd.tap(),function(){i=null,gdd.pages.people.view.clb=function(e){gdd.loadPage(gdd.pages.groups,!0),i=e,s=r.grpMembers},gdd.loadPage(gdd.pages.people)}),$(".btnAddNewMemberFromSession").on(gdd.tap(),function(){i=null,gdd.pages.people.view.clb=function(e){gdd.loadPage(gdd.pages.groups,!0),i=e,s=r.grpSessionAtt},gdd.loadPage(gdd.pages.people)}),gdd.utils.initDatePicker("grpSessionDate",function(t){e.selectedGroupSession.unixSessionDate(t.unix)}),$("#ddlGrpCatType").on("change",function(){var t=$(this).val();if(t){var n=$.grep(e.refData.typesAllowed(),function(e,n){return e.typeId==t});e.selectedGroup.groupTypeId(n[0].typeId),e.selectedGroup.groupType(n[0].typeName),e.selectedGroup.categoryId(n[0].catId),e.selectedGroup.categoryName(n[0].catName)}}),$("#ddlGrpSearchCatType").on("change",function(){var t=$(this).val();if(t){var n=$.grep(e.refData.typesAllowed(),function(e,n){return e.typeId==t});e.grpQry.groupTypeId(n[0].typeId),e.grpQry.categoryId(n[0].catId)}else e.grpQry.categoryId(""),e.grpQry.groupTypeId("")}),$(".grpSearchBack").on(gdd.tap(),function(){o(r.grpList,"down")}),$("#btnGrpSearchExecute").on(gdd.tap(),function(){gdd.showLoader("Searching...");var t=ko.mapping.toJS(e.grpQry);gdd.api.callApi("Groups/SearchGroups","POST",t,{success:function(t){gdd.hideLoader(),t.gddData.length===0?gdd.showMsg("There are no groups matching your search criteria."):(e.searchedGroups.removeAll(),$.each(t.gddData,function(t,n){e.searchedGroups.push(n)}),x(),o(r.grpSearchResults,"left"))},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#btnRefreshGroups2").on(gdd.tap(),function(){$("#popupGrpMore").one("popupafterclose",function(t,n){e.groups.removeAll(),gdd.showLoader("Reloading your groups..."),f(function(){gdd.hideLoader()},function(){gdd.hideLoader()})}),$("#popupGrpMore").popup("close")}),$("#btnShowGrpMore").on(gdd.click(),function(){var e={positionTo:$(this)};gdd.utils.showPopup("popupGrpMore",e)}),$("#btnRefreshGrpRefData").on(gdd.click(),function(){$("#popupGrpMore").one("popupafterclose",function(t,n){gdd.storage.saveGrpRefData(null),e.refData.groupMeetingFrequencies.removeAll(),gdd.showLoader("Loading core data..."),g(function(){gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$("#popupGrpMore").popup("close")}),$("#btnGrpMemSendSMS").on(gdd.click(),function(){$("#popupGrpMenu").one("popupafterclose",function(t,n){gdd.utils.isNative()?(gdd.showLoader("Loading members..."),E(function(){gdd.hideLoader();try{var t="";$.each(e.selectedGroup.members(),function(e,n){t=t+n.mobileNumber+", "});var n="",r="INTENT",i=function(){gdd.hideLoader(),gdd.showMsg("Message sent successfully")},s=function(e){gdd.hideLoader(),gdd.showErr("Message Failed:"+e)};gdd.showLoader("Opening sms module..."),setTimeout(function(){gdd.hideLoader()},5e3),sms.send(t,n,r,i,s)}catch(o){gdd.showErr("SMS ERROR: "+JSON.stringify(o))}},function(e){gdd.hideLoader(),gdd.showErr(e)})):gdd.showMsg("Sending SMS is only available when running this application natively on your phone.")}),$("#popupGrpMenu").popup("close")})};return{searchedGroups:ko.observableArray(),grpQry:{leaderId:ko.observable(""),ageProfileId:ko.observable(undefined),categoryId:ko.observable(""),regionId:ko.observable(undefined),gender:ko.observable(""),groupTypeId:ko.observable(""),meetingDay:ko.observable(""),suburb:ko.observable(undefined),restrictToPortal:ko.observable(!0),isActive:ko.observable(1),openMembership:ko.observable(-1),isPrivate:ko.observable(-1),matchAll:ko.observable(!0)},selectedGroupMember:{id:ko.observable(""),personId:ko.observable(""),groupId:ko.observable(""),userChanged:ko.observable(""),dateChanged:ko.observable(""),isActive:ko.observable(!0),inActiveReason:ko.observable(""),inActiveReasonId:ko.observable(""),moreInfo:ko.observable(""),firstName:ko.observable(""),lastName:ko.observable(""),mobileNumber:ko.observable(""),email:ko.observable(""),birthday:ko.observable(""),groupName:ko.observable(""),typeId:ko.observable(""),category:ko.observable(""),categoryId:ko.observable(""),portalName:ko.observable(""),portalId:ko.observable(""),orgId:ko.observable(""),displayName:ko.observable(""),sourceRecord:{}},selectedGroup:{leaderId:ko.observable(""),leaderName:ko.observable(""),leaderEmail:ko.observable(""),leaderMobileNumber:ko.observable(""),id:ko.observable(""),categoryId:ko.observable(""),categoryName:ko.observable(""),groupTypeId:ko.observable(""),groupType:ko.observable(""),gender:ko.observable(""),meetingDay:ko.observable("Unknown"),meetingTime:ko.observable(""),meetingFrequency:ko.observable(""),groupName:ko.observable(""),groupDescription:ko.observable(""),portalId:ko.observable(""),portalName:ko.observable(""),leadersFacebookId:ko.observable(""),geoLocationId:ko.observable(""),geoLat:ko.observable(""),geoLng:ko.observable(""),geoAddress:ko.observable(""),ageProfileId:ko.observable(""),ageProfile:ko.observable(""),userChanged:ko.observable(""),dateChanged:ko.observable(""),isActive:ko.observable(!0),fullAddressRequired:ko.observable(!0),streetNumber:ko.observable(""),streetName:ko.observable(""),suburb:ko.observable(""),area:ko.observable(""),region:ko.observable(""),city:ko.observable(""),country:ko.observable(""),postalCode:ko.observable(""),otherInfo:ko.observable(""),isPrivate:ko.observable(!1),openMembership:ko.observable(!0),stsId:ko.observable(""),stsIsActive:ko.observable(!0),stsMoreInfo:ko.observable(""),stsReason:ko.observable(""),stsDateChanged:ko.observable(""),stsUserChanged:ko.observable(""),members:ko.observableArray(),sourceRecord:{},sessions:ko.observableArray(),stsReasonId:ko.observable(""),regionId:ko.observable(""),regionName:ko.observable(""),sourceRecord:function(){var t=$.grep(e.groups(),function(t,n){return t.id==e.selectedGroup.id()});return t[0]}},selectedGroupSession:{id:ko.observable(""),name:ko.observable(""),moreInfo:ko.observable(""),flagSession:ko.observable(!1),userChanged:ko.observable(""),dateChanged:ko.observable(""),unixSessionDate:ko.observable(""),sessionDateDisplay:ko.observable(""),groupId:ko.observable(""),attendance:ko.observableArray()},selectedSessionAttendanceRecord:{id:ko.observable(""),personId:ko.observable(""),name:ko.observable(""),mobileNumber:ko.observable(""),email:ko.observable(""),attendanceId:ko.observable(""),attended:ko.observable(""),dateChanged:ko.observable(""),userChanged:ko.observable(""),sessionId:ko.observable(""),groupId:ko.observable(""),sessionDate:ko.observable(""),sessionName:ko.observable("")},groups:ko.observableArray(),create:function(){e=this,gdd.utils.configMergeFromJs(ko),T(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){n?(e.selectedGroup.geoLat()?o(r.grpEdit3,"left"):gdd.showMsg("You did not select an address from the previous screen. Please ensure you move the 'red pin' on the map to the location of this group.",function(){o(r.grpEdit2,"left")}),$("select").selectmenu("refresh"),n=!1,l()):i?(l(),gdd.showLoader("Adding '"+i.firstName+"'"),S(i.id,e.selectedGroup.id,!0,"","",function(){gdd.hideLoader(),d(),i=null,s==r.grpMembers?h():(e.selectedGroupSession.attendance.removeAll(),v(),b())},function(e){gdd.hideLoader(),gdd.showErr(e)})):t===1?(l(),x(),o(r.grpSearchResults,"up"),t=null):(gdd.showLoader("Loading data..."),g(function(){gdd.showLoader("Loading your groups..."),f(function(){gdd.hideLoader(),e.groups().length>0?o(r.grpList,"up"):gdd.showMsg("You have no groups in this database. Lets start by adding your first group.",function(){u()})},function(e){gdd.hideLoader(),gdd.showErr(e)})},function(e){gdd.hideLoader(),gdd.showErr(e)}))},beforeShow:function(){},beforeHide:function(){n=!1},endOldSession:function(){gdd.pages.groups.view.groups.removeAll(),gdd.pages.groups.view.refData.categories.removeAll(),gdd.pages.groups.view.refData.suburbs.removeAll(),gdd.pages.groups.view.refData.ageProfiles.removeAll(),gdd.pages.groups.view.refData.groupsInActiveReasons.removeAll(),gdd.pages.groups.view.refData.groupMembersInActiveReasons.removeAll(),gdd.pages.groups.view.refData.regions.removeAll(),gdd.pages.groups.view.refData.groupMeetingFrequencies.removeAll(),gdd.pages.groups.view.refData.typesAllowed.removeAll()},refData:{categories:ko.observableArray(),suburbs:ko.observableArray(),ageProfiles:ko.observableArray(),groupsInActiveReasons:ko.observableArray(),groupMembersInActiveReasons:ko.observableArray(),regions:ko.observableArray(),groupMeetingFrequencies:ko.observableArray(),typesAllowed:ko.observableArray()}}}),define("views/gmap",[],function(){var e=null,t="http://maps.google.com/mapfiles/ms/icons/red-dot.png",n="http://maps.google.com/mapfiles/ms/icons/green-dot.png",r=function(e){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n={};n={lat:t.coords.latitude,lng:t.coords.longitude},e(n)},function(){e(null)},{timeout:4e4}):e(null)},i=function(e,t,n,r,i){var s=$("#"+e);s.autocomplete({minLength:10,source:function(e,n){t.geocode({address:e.term},function(e,t){n($.map(e,function(e){return{label:e.formatted_address,value:e.formatted_address,geocode:e}}))})},select:function(e,t){n.fitBounds(t.item.geocode.geometry.viewport),r.setPosition(t.item.geocode.geometry.location);var s=o(t.item.geocode);i(s)}})},s=function(e,t,n,r,i){request={},request[e]=t,e||(e="address");if(!t)throw"You must provide an address value to search";if(!r||!i)throw"You must provide both a success and fail callback function.";n.geocode(request,function(n,s){s==google.maps.GeocoderStatus.OK?n[0]?r(n[0]):i("Sorry, something went wrong. Goolge was able to geocode the request, but their servers did not send a response. Try Again!"):e=="address"?i("Sorry! We couldn't find "+t+". Try a different search term, or click the map."):i("Eish, thats pretty remote. Google was unable to perform a reverse lookup of the co-ordinates you provided.")})},o=function(e){var t={lat:null,lng:null,streetNumber:null,streetName:null,suburb:null,area:null,postalCode:null,city:null,region:null,country:null,formatted_address:null},n={streetNumber:"",streetAddress:"",route:"",neighborhood:"",subLocality1:"",subLocality2:"",locality:"",admin1:"",admin2:"",admin3:"",postalCode:"",country:""};return $.each(e.address_components,function(e,t){var r=t.types[0];r==="street_number"&&(n.streetNumber=t.long_name),r==="street_address"&&(n.streetAddress||(n.streetAddress=t.long_name)),r==="route"&&(n.route||(n.route=t.long_name)),r==="neighborhood"&&(n.neighborhood||(n.neighborhood=t.long_name));if(r==="sublocality"||r==="sublocality_level_2"||r==="sublocality_level_1")n.subLocality1?!n.subLocality2&&n.subLocality1!==t.long_name&&(n.subLocality2=t.long_name):n.subLocality1=t.long_name;r==="locality"&&(n.locality||(n.locality=t.long_name)),r==="administrative_area_level_1"&&(n.admin1||(n.admin1=t.long_name)),r==="administrative_area_level_2"&&(n.admin2||(n.admin2=t.long_name)),r==="administrative_area_level_3"&&(n.admin3||(n.admin3=t.long_name)),r==="postal_code"&&(n.postalCode||(n.postalCode=t.long_name)),r==="country"&&(n.country||(n.country=t.long_name))}),t.lat=e.geometry.location.lat(),t.lng=e.geometry.location.lng(),t.formatted_address=e.formatted_address,t.streetNumber=n.streetNumber,t.streetName=n.streetAddress?n.streetAddress:n.route,t.city=n.locality,t.suburb=function(){var e="";return n.neighborhood?e=n.neighborhood:n.subLocality1?e=n.subLocality1:n.subLocality2?e="":e=n.subLocality2,e===t.city?e="":e===""&&n.admin3&&(e=n.admin3),e}(),t.area=function(){var e="";return n.subLocality2?e=n.subLocality2:n.subLocality1?t.suburb===n.subLocality1?e="":e=n.subLocality1:t.suburb===n.neighborhood?e="":e=n.neighborhood,e===""&&(n.admin2?e=n.admin2:e=t.suburb),e}(),t.region=n.admin1,t.postalCode=n.postalCode,t.country=n.country,t},u=function(t){e.returnAddress.streetNumber(t.streetNumber),e.returnAddress.streetName(t.streetName),e.returnAddress.geoLat(t.lat),e.returnAddress.geoLng(t.lng),e.returnAddress.area(t.area),e.returnAddress.city(t.city),e.returnAddress.country(t.country),e.returnAddress.postalCode(t.postalCode),e.returnAddress.region(t.streetName),e.returnAddress.suburb(t.suburb),e.returnAddress.formattedAddress(t.formatted_address),$("#gmapsFormattedAddress").html("formatted address: "+t.formatted_address),$("#btnGmapCancel").hide(),$("#btnGmapDone").fadeIn()},a=function(e,n){gdd.utils.loadGoogleMapsApi(function(){gdd.hideLoader();var r=new google.maps.LatLng(e,n),a=null,f=null,l=null,c={zoom:10,center:r,mapTypeId:google.maps.MapTypeId.ROADMAP};a=new google.maps.Map(document.getElementById("gmapsCanvas"),c),f=new google.maps.Geocoder,l=new google.maps.Marker({position:r,map:a,draggable:!0,animation:google.maps.Animation.DROP,icon:t}),google.maps.event.addListener(l,"dragend",function(){s("latLng",l.getPosition(),f,function(e){var t=o(e);u(t)},function(e){gdd.showErr(e)})}),google.maps.event.addListener(a,"click",function(e){l.setPosition(e.latLng),s("latLng",e.latLng,f,function(e){var t=o(e);u(t)},function(e){gdd.showErr(e)})}),i("gmapsTxtAddress",f,a,l,function(e){u(e)})},function(e){gdd.hideLoader(),gdd.showErr(e)})},f=function(){gdd.showLoader("Google Api..."),gdd.utils.loadGoogleMapsApi(function(){gdd.hideLoader(),r(function(e){var n=null,r=null;e?(r=e.lng,n=e.lat):(r="18.423",n="-33.58");var a=new google.maps.LatLng(n,r),f=null,l=null,c=null,h={zoom:10,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP};f=new google.maps.Map(document.getElementById("gmapsCanvas"),h),l=new google.maps.Geocoder,c=new google.maps.Marker({position:a,map:f,draggable:!0,animation:google.maps.Animation.DROP,icon:t}),google.maps.event.addListener(c,"dragend",function(){s("latLng",c.getPosition(),l,function(e){var t=o(e);u(t)},function(e){gdd.showErr(e)})}),google.maps.event.addListener(f,"click",function(e){c.setPosition(e.latLng),s("latLng",e.latLng,l,function(e){var t=o(e);u(t)},function(e){gdd.showErr(e)})}),i("gmapsTxtAddress",l,f,c,function(e){u(e)})})},function(e){gdd.hideLoader(),gdd.showErr(e)})},l=function(){e.pins.length>0?gdd.utils.loadGoogleMapsApi(function(){var r=new google.maps.LatLng(e.pins[0].lat,e.pins[0].lng),i={zoom:10,center:r},s=new google.maps.Map(document.getElementById("gmapsCanvas"),i),o=new google.maps.InfoWindow;$.each(e.pins,function(e,r){var i=t;r.pinColor&&(r.pinColor=="green"?i=n:i=t);var u;u=new google.maps.Marker({position:new google.maps.LatLng(r.lat,r.lng),animation:google.maps.Animation.DROP,map:s,icon:i,draggable:!1}),google.maps.event.addListener(u,"click",function(e,t){return function(){o.setContent(r.content),o.open(s,u)}}(u,e))}),s.setCenter(new google.maps.LatLng(e.pins[0].lat,e.pins[0].lng))},function(e){gdd.showErr(e)}):gdd.showMsg("There are no valid co-ordinates to load.")},c=function(){var t=$(window).height();$("#gmapsCanvas").css("height",t),e.target=="3"?($("#txtGMapsAutoComplete").hide(),l(),$(".gmapsForView").show(),$(".gmapsForEdit").hide()):(e.returnAddress.streetNumber(""),e.returnAddress.streetName(""),e.returnAddress.geoLat(""),e.returnAddress.geoLng(""),e.returnAddress.area(""),e.returnAddress.city(""),e.returnAddress.country(""),e.returnAddress.postalCode(""),e.returnAddress.region(""),e.returnAddress.suburb(""),e.returnAddress.formattedAddress(""),$("#btnGmapCancel").show(),$("#btnGmapDone").hide(),$(".gmapsForView").hide(),$(".gmapsForEdit").show(),$("#txtGMapsAutoComplete").show(),$("#gmapsStartMessage").html(e.helpTxt),$("#popupGmapsStartMessage").popup("open",{transition:"pop"}),e.lat?a(e.lat,e.lng):f())},h=function(){$("#btnGmapDone").on(gdd.tap(),function(){e.callbackFunction(ko.mapping.toJS(e.returnAddress)),gdd.utils.loadPage(e.callbackPage,!0,"slideup")}),$("#btnGmapCancel").on(gdd.tap(),function(){e.returnAddress.streetNumber(""),e.returnAddress.streetName(""),e.returnAddress.geoLat(""),e.returnAddress.geoLng(""),e.returnAddress.area(""),e.returnAddress.city(""),e.returnAddress.country(""),e.returnAddress.postalCode(""),e.returnAddress.region(""),e.returnAddress.suburb(""),e.returnAddress.formattedAddress(""),e.callbackFunction(ko.mapping.toJS(e.returnAddress)),gdd.utils.loadPage(e.callbackPage,!0,"slideup")}),$(".btnGMapRefresh").on(gdd.tap(),function(){c()})};return{callbackFunction:null,callbackPage:null,lat:null,lng:null,pins:new Array,helpTxt:"",target:null,returnAddress:{streetNumber:ko.observable(""),streetName:ko.observable(""),geoLat:ko.observable(""),geoLng:ko.observable(""),area:ko.observable(""),city:ko.observable(""),country:ko.observable(""),postalCode:ko.observable(""),region:ko.observable(""),suburb:ko.observable(""),formattedAddress:ko.observable("")},configForTest:function(e,t,n,r){gdd.pages.gmap.view.target=null,gdd.pages.gmap.view.callbackFunction=e,gdd.pages.gmap.view.callbackPage=t,gdd.pages.gmap.view.lat=n,gdd.pages.gmap.view.lng=r},configurePageForAddressEdit:function(e,t,n,r,i){gdd.pages.gmap.view.callbackFunction=e,gdd.pages.gmap.view.callbackPage=t,gdd.pages.gmap.view.lat=n,gdd.pages.gmap.view.lng=r;switch(i){case 1:gdd.pages.gmap.view.helpTxt="To choose a meeting location for your group either:<ul><li>Click on the map to drop a new pin or drag an existing pin</li><li>Start typing the address in the text box provided and choose from the list of Google matched addresses</li></ul>";break;case 2:gdd.pages.gmap.view.helpTxt="To add a new address either:<ul><li>Click on the map to drop a new pin or drag an existing pin</li><li>Start typing the address in the text box provided and choose from the list of Google matched addresses</li></ul>";break;default:gdd.pages.gmap.view.helpTxt="Click on the map to select the address location, or type the address in the textbox provided."}},configureForDropPins:function(e){gdd.pages.gmap.view.target=3,gdd.pages.gmap.view.pins=e},create:function(){e=this,gdd.utils.configMergeFromJs(ko),h(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){c()},beforeShow:function(){},beforeHide:function(){gdd.pages.gmap.view.pins.length=0},endOldSession:function(){gdd.pages.gmap.view.pins.length=0}}}),define("views/requestpermission",[],function(){var e=null,t=function(){$("#btnRequestPermission").on(gdd.tap(),function(){gdd.showLoader("Working..."),gdd.api.callApi("Security/RequestPermission","GET",{info:e.msg()},{success:function(e){gdd.hideLoader(),gdd.showMsg(e.gddData,function(){gdd.loadPage(gdd.utils.previousPage,!0,"slide")})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})})};return{msg:ko.observable(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),t(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/events",[],function(){var e=null,t=!0,n={all:".eventView",list:".eventListView",noEvents:".noEventsView",register:".eventRegisterView",attendance:".eventAttendanceView",qrCode:".eventQrCodeView"},r=function(n,i,s){var o=function(e){p.length>0&&(p[0].attended=i),s&&s(e)},u=function(e){$("#ticketError").html(e),gdd.showPopup("evPopupTicketError"),p.length>0&&(p[0].attended=!i,t=!1,$(".btnAttRegListFlipSwitch[data-id='"+p[0].personId+"']").prop("checked",!i),$(".btnAttRegListFlipSwitch").flipswitch("refresh"),t=!0),$("#btnTicketOverride").one(gdd.tap(),function(){t=!1,$(".btnAttRegListFlipSwitch[data-id='"+p[0].personId+"']").prop("checked",i),$(".btnAttRegListFlipSwitch").flipswitch("refresh"),t=!0,$("#evPopupTicketError").one("popupafterclose",function(e,t){r(!0,i)}),$("#evPopupTicketError").popup("close")})},a=function(e){gdd.hideLoader(),gdd.showErr(m.msg)},f=$("#evAttEnableLocalCache").val(),l;f=="1"?l=!0:l=!1;var c=e.selectedAttendee.guid(),h=e.selectedEvent.eventId(),p=$.grep(e.selectedEvent.attendees(),function(e,t){return e.guid==c}),d=gdd.storage.getEventRegCache(),v=$.grep(d,function(e,t){return e.guid==c});v.length===0&&(l=!0);if(l){var m={};m.eventId=e.selectedEvent.eventId(),m.guid=c,m.override=n,m.attended=i,gdd.showLoader("Processing..."),gdd.api.callApi("Events/ToggleEventAttendance","POST",m,{success:function(e){gdd.hideLoader();var t=e.gddData,n=t.split("|")[0],r=t.split("|")[1];n=="0"?u(r):(v[0].attended=i,v[0].isDirty=!1,gdd.storage.saveEventRegCache(d),o(r))},fail:function(e){a(e.msg)}})}else v[0].pmtRequired&&i&&!v[0].paid?n?(v[0].attended=i,v[0].isDirty=!0,o(v[0].firstName+" has been marked as present. NOTE: Payment has not been made.")):u("This person has not paid for the event."):(v[0].attended=i,v[0].isDirty=!0,i?o(v[0].firstName+" has been marked as present."):o(v[0].firstName+" has been marked as absent.")),gdd.storage.saveEventRegCache(d)},i=function(t){if(gdd.utils.isNative())try{$(t).attr("href","#").removeAttr("target"),$(t).one(gdd.click(),function(){try{var t=window.open(e.selectedEvent.googleFormUrl(),"_system","location=yes,closebuttoncaption=Done/Close");$("#popupEventActionsMenu").popup("close")}catch(n){alert("We could no load the Google form: "+n)}})}catch(n){alert("We could no load the Google form: "+n)}else $(t).attr("href",e.selectedEvent.googleFormUrl()).attr("target","_blank"),$(t).one(gdd.click(),function(){$("#popupEventActionsMenu").popup("close")})},s=function(e,t,r){gdd.utils.slideTransitionView($(n.all),$(e),t,function(){switch(e){case n.list:$("#eventsHeader").html("Events");var t=gdd.storage.getEventRegCache(),i=0;if(t){var s=$.grep(t,function(e,t){return e.isDirty===!0});i=s.length}i>0?($("#btnSaveUnSyncedEvRegInfo").html("Sync("+i+")"),$("#btnUnsyncedEvRegInfo").fadeIn()):$("#btnUnsyncedEvRegInfo").hide();break;case n.noEvents:$("#eventsHeader").html("Events");break;case n.register:$("#eventsHeader").html("Register");break;case n.attendance:$("#eventsHeader").html("Attendance")}r&&r()})},o=function(t){var n={};n.personId=gdd.session.personId(),n.eventId=e.selectedEvent.eventId(),n.paid=e.selectedEvent.paid(),n.regTypeId=e.selectedEvent.regTypeId(),n.isComing=t,n.emailGoogleForm=!0,t=="1"?gdd.showLoader("Registering..."):gdd.showLoader("Un-Registering..."),gdd.api.callApi("Events/ToggleReg","POST",n,{success:function(t){gdd.hideLoader();var n=t.gddData[0],r=$.grep(e.events(),function(e,t){return n.eventId==e.eventId}),s=0;r.length>0&&(s=e.events.indexOf(r[0]),e.events.splice(s,1)),ko.mapping.mergeFromJS(e.selectedEvent,n),e.events.splice(s,0,n),c(),n.coming?($("#eventRegThankYouText").html($("#eventRegThankYouText").html().replace("##regcode##",n.regCode)),$("#viewRegWithMultipleRegTypes").hide(),$("#viewRegComplete").fadeIn(),n.googleFormStillRequired?($("#btnEventRegGoogleForm").show(),i($("#btnEventRegGoogleForm"))):$("#btnEventRegGoogleForm").hide(),n.pmtRequired=="1"?$(".btnEventPayNow").show():$(".btnEventPayNow").hide()):gdd.showMsg("We have recorded you as NOT attending the event.")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})},u=function(){$("#evAttList").listview("refresh"),$(".btnAttRegListFlipSwitch").flipswitch(),$(".btnAttRegListFlipSwitch").flipswitch("refresh"),$(".btnAttRegListFlipSwitch").off().on("change",function(n){if(t){var i=$(this).attr("data-id"),s=$.grep(e.selectedEvent.attendees(),function(e,t){return e.personId==i});ko.mapping.mergeFromJS(e.selectedAttendee,ko.mapping.toJS(s[0]));var o;$(this).is(":checked")?o=!0:o=!1,r(!1,o)}})},a=function(){var t=function(e,t){return e.firstName<t.firstName?-1:e.firstName>t.firstName?1:0},n=gdd.storage.getEventRegCache();e.selectedEvent.attendees.removeAll();var r=new Array;n&&$.each(n,function(t,n){n.eventId==e.selectedEvent.eventId()&&r.push(n)}),r.sort(t),$.each(r,function(t,n){e.selectedEvent.attendees.push(n)}),e.selectedEvent.attendees().length>0?u():(gdd.showLoader("Loading attendees..."),gdd.api.callApi("Events/GetRegistrantInfo","GET",{eventId:e.selectedEvent.eventId(),filter:1},{success:function(r){gdd.hideLoader();var i=r.gddData;if(n){var s=$.grep(n,function(t,n){return t.eventId==e.selectedEvent.eventId()});$.each(s,function(e,t){n.splice(n.indexOf(t),1)}),$.each(i,function(e,t){n.push(t)}),n.sort(t),gdd.storage.saveEventRegCache(n)}else gdd.storage.saveEventRegCache(i);$.each(i,function(t,n){e.selectedEvent.attendees.push(n)}),u()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))},f=function(e,t){var n=gdd.storage.getEventRegCache();if(n)if(n.length>0){var r=function(){var t=$.grep(n,function(e,t){return e.isDirty?!0:!1});t.length===0&&(gdd.storage.saveEventRegCache(),n,e())};$.each(n,function(e,n){if(n.isDirty){var i={};i.eventId=n.eventId,i.guid=n.guid,i.override=!0,i.attended=n.attended,gdd.api.callApi("Events/ToggleEventAttendance","POST",i,{success:function(e){n.isDirty=!1,r()},fail:function(e){t(e.msg)}})}})}else e();else e()},l=function(n){var i=$.grep(e.selectedEvent.attendees(),function(e,t){return e.guid==n});i.length>0?(ko.mapping.mergeFromJS(e.selectedAttendee,ko.mapping.toJS(i[0])),t=!1,$(".btnAttRegListFlipSwitch[data-id='"+i[0].personId+"']").prop("checked",!0),$(".btnAttRegListFlipSwitch").flipswitch("refresh"),t=!0,r(!1,!0,function(e){gdd.app.showGlbMsg("Success!",e)})):gdd.showWarning("This is not a valid ticket for this event. Please check the person is using the correct QRCode.")},c=function(){var t=function(t){var n=$.grep(e.events(),function(e,n){return e.eventId==t});e.selectedEvent.eventId()&&e.selectedEvent.eventId()!=n[0].eventId&&(e.selectedEventQrCode=null,e.selectedEvent.attendees.removeAll()),ko.mapping.mergeFromJS(e.selectedEvent,n[0])};$(".evMore").off().on(gdd.click(),function(e){var n=$(this).attr("data-id");t(n),gdd.showPopup("popupEventActionsMenu")}),$(".evNotComing").off().on(gdd.tap(),function(n){var r=$(this).attr("data-id");t(r),e.selectedEvent.allowRegistration()?o(0):gdd.showMsg(e.selectedEvent.registrationMessage())}),$(".evComing").off().on(gdd.tap(),function(r){var i=$(this).attr("data-id");t(i),e.selectedEvent.allowRegistration()?($("#viewRegComplete").hide(),$("#viewRegWithMultipleRegTypes").hide(),e.selectedEvent.regTypesList().length>1?$("#viewRegWithMultipleRegTypes").show():e.selectedEvent.regTypeId(e.selectedEvent.regTypesList()[0].id),s(n.register,"left",function(){e.selectedEvent.regTypesList().length===1&&o(1),$(".btnEventViewBack").off().one(gdd.tap(),function(){s(n.list,"right")})})):gdd.showMsg(e.selectedEvent.registrationMessage())})},h=function(){e.events().length>0?(c(),s(n.list,"left")):(gdd.showLoader("Loading events..."),gdd.api.callApi("Events/GetMyEventProfiles","GET",null,{success:function(t){gdd.hideLoader(),t.gddData.length===0?s(n.noEvents,"up"):($.each(t.gddData,function(t,n){e.events.push(n)}),c(),s(n.list,"left"))},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))},p=function(){$("#btnEventEmailTicket").on(gdd.click(),function(){$("#popupEventActionsMenu").one("popupafterclose",function(t,n){gdd.showLoader("Sending email..."),gdd.api.callApi("Events/EmailPersonsEventTicket","GET",{personId:gdd.session.personId(),eventId:e.selectedEvent.eventId()},{success:function(e){gdd.hideLoader(),gdd.showMsg(e.gddData)},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupEventActionsMenu").popup("close")}),$("#btnEventVolunteer").on(gdd.tap(),function(){$("#popupEventActionsMenu").one("popupafterclose",function(t,n){var r={};r.personId=gdd.session.personId(),r.eventId=e.selectedEvent.eventId(),e.selectedEvent.isVolunteer()?r.volunteer=!1:r.volunteer=!0,gdd.showLoader("Processing..."),gdd.api.callApi("Events/Volunteer","POST",r,{success:function(t){gdd.hideLoader();var n=$.grep(e.events(),function(t,n){return t.eventId==e.selectedEvent.eventId()});if(n.length>0){var i=e.events.indexOf(n[0]);r.volunteer?(e.selectedEvent.isVolunteer(!0),n[0].isVolunteer=!0):(e.selectedEvent.isVolunteer(!1),n[0].isVolunteer=!1),e.events.splice(i,1,n[0]),c()}},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupEventActionsMenu").popup("close")}),$("#btnEventViewTicket").on(gdd.tap(),function(){var t=function(){$("#evNameDigiTicket").html(e.selectedEvent.eventName()),$("#evListImgQrCode").attr("src",e.selectedEventQrCode),s(n.qrCode,"up",function(){$(".btnEventViewBack").on(gdd.tap(),function(){s(n.list,"down",function(){})})})};$("#popupEventActionsMenu").one("popupafterclose",function(n,r){e.selectedEventQrCode?t():(gdd.showLoader("Fetching ticket..."),gdd.api.callApi("Events/GetPersonsEventQRCode","GET",{personId:gdd.session.personId(),eventId:e.selectedEvent.eventId()},{success:function(n){gdd.hideLoader(),e.selectedEventQrCode=n.gddData,t()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))}),$("#popupEventActionsMenu").popup("close")}),$("#btnEventVewGoogleResponses").on(gdd.click(),function(){$("#popupEventActionsMenu").one("popupafterclose",function(t,n){if(e.selectedEvent.googleFormSubmission().length>0){var r="<table>";$.each(e.selectedEvent.googleFormSubmission(),function(e,t){t.field.indexOf("Timestamp")===-1&&t.field.indexOf("RegCode")===-1&&(r+="<tr><td><div><strong>"+t.field+"</strong></div><div>"+t.value+"</td><div></tr>")}),r+="</table>",$("#evListGoogleRes").html(r),gdd.showPopup("evListGoogleFormResponsesPopup")}else gdd.showMsg("<p>We have no record at this stage of you having completed the online form.</p><p>It is likely that we are still processing the data collected by the online form.</p> ")}),$("#popupEventActionsMenu").popup("close")}),$("#btnEventViewMap").on(gdd.tap(),function(){$("#popupEventActionsMenu").one("popupafterclose",function(t,n){var r=e.selectedEvent.geoLat(),i=e.selectedEvent.geoLng();if(r&&i){var s=new Array;s.push({lat:r,lng:i,pinColor:"red",content:e.selectedEvent.eventName()}),gdd.pages.gmap.view.configureForDropPins(s),gdd.loadPage(gdd.pages.gmap,!1,"slideup")}else gdd.showMsg("No mapping data has been configured for this event.")}),$("#popupEventActionsMenu").popup("close")}),$("#btnDelUnsyncedEvRegInfo").on(gdd.tap(),function(){gdd.showPopup("popupDeleteDirtyEvRegItems"),$("#btnYesDeleteDirtyEvRegItems").one(gdd.click(),function(){gdd.storage.saveEventRegCache(null),$("#btnUnsyncedEvRegInfo").hide(),$("#popupDeleteDirtyEvRegItems").popup("close")})}),$("#btnSaveUnSyncedEvRegInfo").on(gdd.tap(),function(){gdd.showLoader("Syncing..."),f(function(){gdd.hideLoader(),$("#btnUnsyncedEvRegInfo").fadeOut()},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$("#btnEvScanSaveLater").on(gdd.tap(),function(){$("#popupEvLocalScanSave").one("popupafterclose",function(e,t){s(n.list,"left")}),$("#popupEvLocalScanSave").popup("close")}),$("#btnEvScanSaveNow").on(gdd.tap(),function(){$("#popupEvLocalScanSave").one("popupafterclose",function(e,t){gdd.showLoader("Syncing..."),f(function(){gdd.hideLoader(),s(n.list,"left")},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$("#popupEvLocalScanSave").popup("close")}),$("#btnEvScanStart").on(gdd.tap(),function(){if(gdd.utils.isNative())try{cordova.plugins.barcodeScanner.scan(function(e){e.cancelled=="0"&&l(e.text)},function(e){gdd.showErr("Scanning failed: "+e)})}catch(e){gdd.showErr("Cordova Error: "+e)}else gdd.showMsg("The barcode scanner is not available on the web app. Please install our app for your phone.")}),$("#evAttEnableLocalCache").on("change",function(){var e=$(this).val();e=="1"?gdd.showMsg("Live scanning is now enabled. All attendance data will be synced to the database in real time."):gdd.showMsg("Local cache scanning is now enabled. Attendance data will be stored in a local cache which you will need to sync at a later stage. ")}),$("#btnEvViewAttDone").on(gdd.tap(),function(){var e=gdd.storage.getEventRegCache(),t=0;if(e){var r=$.grep(e,function(e,t){return e.isDirty===!0});t=r.length}t>0?gdd.showPopup("popupEvLocalScanSave"):s(n.list,"left")}),$("#btnEvViewAttList").on(gdd.tap(),function(){$.when($(".evAttSubView").not(".evAttListView").hide("slide",{direction:"up"})).then(function(){$(".evAttListView").show("slide",{direction:"down"})})}),$("#btnEvViewAttScan").on(gdd.tap(),function(){$.when($(".evAttSubView").not(".evAttScanView").hide("slide",{direction:"down"})).then(function(){$(".evAttScanView").show("slide",{direction:"up"})})}),$("#btnEventManageAttendance").on(gdd.tap(),function(){$("#popupEventActionsMenu").one("popupafterclose",function(t,r){var i=e.selectedEvent.isAttendanceManager();i?s(n.attendance,"left",function(){a(),$(".btnEventViewBack").one(gdd.tap(),function(){s(n.list,"right")})}):gdd.utils.requestPermission("Request permission to manage attendance at the event '"+e.selectedEvent.eventName()+"'")}),$("#popupEventActionsMenu").popup("close")}),$(".btnReloadEvents").on(gdd.tap(),function(){e.events.removeAll(),h()}),$(".btnEventPayNow").on(gdd.tap(),function(){$(this).is("a")?($("#popupEventActionsMenu").one("popupafterclose",function(e,t){gdd.showPopup("popupEventChoosePayment")}),$("#popupEventActionsMenu").popup("close")):gdd.showPopup("popupEventChoosePayment")}),$("#btnPayWithCC").on(gdd.tap(),function(){$("#popupEventChoosePayment").one("popupafterclose",function(t,n){gdd.showLoader("Securing gateway..."),gdd.api.callApi("Payments/GatewayIsActive","GET",{portalId:gdd.portalId},{success:function(t){gdd.hideLoader();var n=t.gddData;n.mode===0?gdd.showMsg(n.desc):(gdd.pages.payment.view.auth.cardHolder(""),gdd.pages.payment.view.auth.cardNumber(""),gdd.pages.payment.view.auth.expMonth("01"),gdd.pages.payment.view.auth.expYear("2015"),gdd.pages.payment.view.auth.cvc(""),gdd.pages.payment.view.auth.amount(e.selectedEvent.cost()),gdd.pages.payment.view.auth.ccy(e.selectedEvent.ccy()),gdd.pages.payment.view.auth.entity("Event"),gdd.pages.payment.view.auth.entityId(e.selectedEvent.eventId()),gdd.pages.payment.view.auth.description("Pay for event '"+e.selectedEvent.eventName()),n.mode===1?gdd.pages.payment.view.auth.simulateOption("2"):gdd.pages.payment.view.auth.simulateOption("0"),gdd.loadPage(gdd.pages.payment))},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupEventChoosePayment").popup("close")}),$("#btnPayNoCC").on(gdd.tap(),function(){$("#popupEventChoosePayment").one("popupafterclose",function(t,n){$("#evListPmtInst").html(e.selectedEvent.pmtInstructions()),gdd.showPopup("evListPmtInstructions")}),$("#popupEventChoosePayment").popup("close")}),$("#btnRegWithMoreThanOneRegType").on(gdd.click(),function(){e.selectedEvent.regTypeId($("#ddlRegType").val()),o(1)}),$("#popupEventActionsMenu").on("popupbeforeposition",function(t,n){e.selectedEvent.googleFormUrl()&&i($("#btnEventFillOutGoogleForm")),e.selectedEvent.coming()=="1"?(e.selectedEvent.googleFormSubmission().length>0?$("#btnEventVewGoogleResponses").show():$("#btnEventVewGoogleResponses").hide(),e.selectedEvent.googleFormStillRequired()?$("#btnEventFillOutGoogleForm").show():$("#btnEventFillOutGoogleForm").hide(),e.selectedEvent.pmtRequired()=="1"?e.selectedEvent.paid()?$(".btnEventPayNow").hide():$(".btnEventPayNow").show():$(".btnEventPayNow").hide(),$("#btnEventViewTicket").show(),$("#btnEventEmailTicket").show(),e.selectedEvent.isVolunteer()?$("#btnEventVolunteer").html("I cannot volunteer"):$("#btnEventVolunteer").html("Volunteer at this event"),$("#btnEventVolunteer").show()):($("#btnEventVolunteer").hide(),$("#btnEventVewGoogleResponses").hide(),$("#btnEventFillOutGoogleForm").hide(),$(".btnEventPayNow").hide(),$("#btnEventViewTicket").hide(),$("#btnEventEmailTicket").hide(),$("#btnEventManageAttendance").hide())})};return{scanType:1,selectedEventQrCode:null,selectedEvent:{eventId:ko.observable(""),eventName:ko.observable(""),description:ko.observable(""),imageUrl:ko.observable(""),startDate:ko.observable(""),endDate:ko.observable(""),startTime:ko.observable(""),endTime:ko.observable(""),tagLine:ko.observable(""),capacity:ko.observable(""),isActive:ko.observable(!0),minSecLevel:ko.observable(""),featured:ko.observable(!1),regStartDate:ko.observable(""),regEndDate:ko.observable(""),allowRegistration:ko.observable(!1),registrationMessage:ko.observable(""),allowMultipleReg:ko.observable(!1),regLabel:ko.observable(""),eventWebAddress:ko.observable(""),eventVenue:ko.observable(""),geoLat:ko.observable(""),geoLng:ko.observable(""),attendanceRegIsPublic:ko.observable(!1),ownerPortalId:ko.observable(""),ownerPortalName:ko.observable(""),pmtInstructions:ko.observable(""),helpText:ko.observable(""),regId:ko.observable(""),regTypeId:ko.observable(""),changedOn:ko.observable(""),changedBy:ko.observable(""),attended:ko.observable(!1),personId:ko.observable(""),paid:ko.observable(!1),coming:ko.observable(-1),googleFormSubmission:ko.observableArray(),regCode:ko.observable(""),regType:ko.observable(""),pmtRequired:ko.observable(-1),cost:ko.observable(""),ccy:ko.observable(""),summary:ko.observable(""),googleFormStillRequired:ko.observable(!0),googleFormUrl:ko.observable(""),googleFormIsActive:ko.observable(!0),googleFormSubmitted:ko.observable(!0),regTypesList:ko.observableArray(),isAttendanceManager:ko.observable(!1),isVolunteer:ko.observable(!1),attendees:ko.observableArray()},events:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id)),p()},show:function(){h()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.events.view.events.removeAll()},selectedAttendee:{personId:ko.observable(""),firstName:ko.observable(""),lastName:ko.observable(""),email:ko.observable(""),mobileNumber:ko.observable(""),regId:ko.observable(""),eventId:ko.observable(""),userChanged:ko.observable(""),dateChanged:ko.observable(""),attended:ko.observable(!1),paid:ko.observable(!1),regTypeId:ko.observable(""),regType:ko.observable(""),regTypeId:ko.observable(""),pmtRequired:ko.observable(!1),cost:ko.observable(""),ccy:ko.observable(""),registered:ko.observable(!1),isComing:ko.observable(-1),regCode:ko.observable(""),moreInfo:ko.observableArray(),googleResponseRowNumber:ko.observable(""),googleFormCompleted:ko.observable(""),googleFormUrl:ko.observable(""),isAttendanceManager:ko.observable(!1),isVolunteer:ko.observable(!1),guid:ko.observable("")}}}),define("views/payment",[],function(){var e=null,t=function(){switch(e.auth.simulateOption()){case"1":e.auth.cardHolder("VISA: Pin Verify"),e.auth.cardNumber("4000000000000002"),e.auth.cvc("000");break;case"3":e.auth.cardHolder("VISA: Fail - No Funds"),e.auth.cardNumber("4000000000000028"),e.auth.cvc("000");break;default:e.auth.cardHolder("AMX Success"),e.auth.cardNumber("378282246310005"),e.auth.cvc("000")}},n=function(){$("#ccSimulate").hide(),$(".btnPayNowCancel").on(gdd.tap(),function(){gdd.loadPage(gdd.utils.previousPage,!0,"slide")}),$(".ccSimulate").on("change",function(){var n=$(this).val();e.auth.simulateOption(n),t()}),$("#PopupCC3DReq").on("popupbeforeposition",function(t,n){var r=$("#btn3DSecGo");gdd.utils.isNative()?($(r).attr("href","#").removeAttr("target"),$(r).one(gdd.click(),function(){var t=window.open(e.authResult.authReqUrl,"_system","location=yes,closebuttoncaption=Done/Close");$("#PopupCC3DReq").one("popupafterclose",function(e,t){gdd.pages.events.view.events.removeAll(),gdd.loadPage(gdd.utils.previousPage,!0,"slide")}),$("#PopupCC3DReq").popup("close")})):($(r).attr("href",e.authResult.authReqUrl).attr("target","_blank"),$(r).one(gdd.click(),function(){$("#PopupCC3DReq").one("popupafterclose",function(e,t){gdd.pages.events.view.events.removeAll(),gdd.loadPage(gdd.utils.previousPage,!0,"slide")}),$("#PopupCC3DReq").popup("close")}))}),$("#ccPaymentSuccess").on("popupafterclose",function(e,t){gdd.pages.events.view.events.removeAll(),gdd.loadPage(gdd.utils.previousPage,!0,"slide")}),$("#btnCcPayNow").on(gdd.tap(),function(){var t=ko.mapping.toJS(e.auth),n=!0;t.cardHolder&&t.cardNumber&&t.cvc?(gdd.showLoader("Processing..."),gdd.api.callApi("Payments/Authorize","POST",t,{success:function(t){gdd.hideLoader();var n=t.gddData;e.authResult=n;switch(n.code){case 0:gdd.showErr("<p>While trying to process the card the following error occurred.</p><p>"+n.message+"<p/>");break;case 1:gdd.showPopup("PopupCC3DReq");break;case 2:$("#ccAuthError").html(n.message),gdd.showPopup("popupCCFailed");break;case 3:gdd.showPopup("ccPaymentSuccess");break;default:gdd.showErr("An unknown response code was returned from the server. Please contact support.")}},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})):gdd.showMsg("You have not entered all the fields, or some are not valid.")})};return{authResult:null,auth:{cardHolder:ko.observable(""),cardNumber:ko.observable(""),expMonth:ko.observable(""),expYear:ko.observable(""),cvc:ko.observable(""),amount:ko.observable(""),ccy:ko.observable(""),entity:ko.observable(""),entityId:ko.observable(""),simulateOption:ko.observable(""),description:ko.observable("")},create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),n(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){if(e.auth.entity()&&e.auth.entityId()&&e.auth.amount()&&e.auth.ccy()){$("#btnCcPayNow").html("Pay Now ("+e.auth.ccy()+e.auth.amount()+")");if(e.auth.simulateOption()!="0"){var n=e.auth.simulateOption();$("#ccSimulate").show(),$("#ccPmtOnlineNotice").hide(),$("#ccPmtSimulateNotice").show(),$("[type='radio'][value='"+n+"']").prop("checked",!0),$(".ccSimulate").checkboxradio("refresh"),t(),gdd.showPopup("popupCCSimulation")}else $("#ccSimulate").hide(),$("#ccPmtOnlineNotice").show(),$("#ccPmtSimulateNotice").hide()}else gdd.showMsg("This page has not been configured for the payment gateway. Please contact your church office.",function(){gdd.loadPage(gdd.utils.previousPage,!0,"slide")})},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/sermons",[],function(){var e=null,t={all:".sermonView",feeds:".feedsView",noFeeds:".noFeedsView",items:".itemsView"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.feeds:break;case t.items:}r&&r()})},r=function(){n(t.items,"left",function(){o(),$(".btnSermonViewBack").one(gdd.tap(),function(){n(t.feeds,"right")})})},i=function(){if(gdd.utils.isNative()){var t=e.selectedSermon.linkUrl(),n={bgColor:"#FFFFFF",bgImage:"/img/audiobackground.jpg",bgImageScale:"fit",successCallback:function(){},errorCallback:function(e){gdd.showMsg("The version of OS you are running on your phone is to old to run this media player: "+e)}};window.plugins.streamingMedia.playAudio(t,n)}else gdd.showMsg("To listen to the sermon you must be running this app on your phone. To listen to it in the web version, use the 'Email Me Link' option.")},s=function(){$("#btnFeedItemFinished").on(gdd.click(),function(){$("#popupSermonItemMenu").one("popupafterclose",function(t,n){gdd.showLoader("Processing..."),gdd.api.callApi("Feeds/UpdatePersonReadStatus","GET",{personId:gdd.session.personId(),feedItemId:e.selectedSermon.id(),read:!0},{success:function(t){gdd.hideLoader();var n=$.grep(e.selectedFeed.items(),function(t,n){return t.id==e.selectedSermon.id()});e.selectedFeed.items.splice(e.selectedFeed.items.indexOf(n[0]),1),gdd.showMsg("This sermon has been marked as complete. If you refresh the channel, the next sermon available will be added to this list.")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupSermonItemMenu").popup("close")}),$("#btnFeedItemEmail").on(gdd.click(),function(){$("#popupSermonItemMenu").one("popupafterclose",function(t,n){gdd.showLoader("Sending email..."),gdd.api.callApi("Feeds/EmailFeedItem","GET",{personId:gdd.session.personId(),feedItemId:e.selectedSermon.id()},{success:function(e){gdd.hideLoader(),gdd.showMsg("We have sent you an email with the download link for the sermon title you requested.")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupSermonItemMenu").popup("close")}),$(".btnReloadSermons").on(gdd.tap(),function(){e.feeds.removeAll(),a()}),$("#btnSermonsView").on(gdd.click(),function(){$("#popupSermonMenu").one("popupafterclose",function(e,t){r()}),$("#popupSermonMenu").popup("close")}),$("#btnSermonsToggleSubs").on(gdd.click(),function(){$("#popupSermonMenu").one("popupafterclose",function(t,n){var r=null;e.selectedFeed.isSubscribed()?(gdd.showLoader("un-subscribing..."),r=!1):(r=!0,gdd.showLoader("subscribing...")),gdd.api.callApi("Feeds/UpdatePersonSubscription","GET",{personId:gdd.session.personId(),feedId:e.selectedFeed.id(),subscribe:r},{success:function(t){gdd.hideLoader();var n=$.grep(e.feeds(),function(t,n){return t.id==e.selectedFeed.id()}),i=e.feeds.indexOf(n[0]);e.feeds.splice(i,1),n[0].isSubscribed=r,e.feeds.splice(i,0,n[0]),u(),r?gdd.showMsg("You have been subscribed to this channel. Whenever this channel is updated you will receive an email with the latest sermons."):gdd.showMsg("You have been un-subscribed from this channel.")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupSermonMenu").popup("close")}),$("#popupSermonMenu").on("popupbeforeposition",function(t,n){e.selectedFeed.isSubscribed()?$("#btnSermonsToggleSubs").html("UnSubscribe"):$("#btnSermonsToggleSubs").html("Subscribe")})},o=function(){gdd.session.signedIn()?($(".signedInModule").show(),$(".publicModule").hide()):($(".signedInModule").hide(),$(".publicModule").show()),$(".sermonMenu").off().on(gdd.click(),function(){var t=$(this).attr("data-id"),n=$.grep(e.selectedFeed.items(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedSermon,n[0]),gdd.showPopup("popupSermonItemMenu",{positionTo:$(this)})}),$(".listenNow").off().on(gdd.tap(),function(){var t=$(this).attr("data-id"),n=$.grep(e.selectedFeed.items(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedSermon,n[0]),i()})},u=function(){gdd.session.signedIn()?($(".signedInModule").show(),$(".publicModule").hide()):($(".signedInModule").hide(),$(".publicModule").show()),$("#feedsListView").listview("refresh");var t=function(t){var n=$.grep(e.feeds(),function(e,n){return e.id==t});ko.mapping.mergeFromJS(e.selectedFeed,n[0])};$(".feedsItemMenu").off().on(gdd.click(),function(e){t($(this).attr("data-id")),gdd.showPopup("popupSermonMenu",{positionTo:$(this)})}),$(".viewSermons").off().on(gdd.click(),function(n){t($(this).attr("data-id")),e.selectedFeed.items().length===0?gdd.showMsg("There are no unread sermons in this channel."):r()})},a=function(){e.feeds().length>0?u():(gdd.showLoader("Loading..."),gdd.api.callApi("Feeds/GetPersonsUnreadPortalFeeds","GET","",{success:function(r){gdd.hideLoader();var i=r.gddData;i.length===0?n(t.noFeeds,"up"):(e.feeds.removeAll(),$.each(i,function(t,n){e.feeds.push(n)}),u())},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))};return{feeds:ko.observableArray(),selectedFeed:{isSubscribed:ko.observable(!1),description:ko.observable(),id:ko.observable(),imageUrl:ko.observable(),lastUpdatedTime:ko.observable(),title:ko.observable(),feedUrl:ko.observable(),linkUrl:ko.observable(),linkTitle:ko.observable(),isActive:ko.observable(),feedContent:ko.observable(),personId:ko.observable(),subscriptionId:ko.observable(),firstName:ko.observable(),lastName:ko.observable(),email:ko.observable(),mobileNumber:ko.observable(),isGlobalDefault:ko.observable(),items:ko.observableArray()},selectedSermon:{id:ko.observable(),lastUpdatedTime:ko.observable(),linkUrl:ko.observable(),linkTitle:ko.observable(),publishDate:ko.observable(),summary:ko.observable(),title:ko.observable(),fileExt:ko.observable(),feedId:ko.observable(),imageUrl:ko.observable()},create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),s(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){a()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.sermons.view.feeds.removeAll()}}}),define("views/profile",[],function(){var e=null,t=!1,n=null,r={all:".profileView",account:".profileAccountView",addresses:".profileAddressListView",newAddress:".profileNewAddress"},i=function(t,i,s){gdd.utils.slideTransitionView($(r.all),$(t),i,function(){switch(t){case r.account:n=r.account,$("#profileHeader").html("Profile");break;case r.addresses:n=r.addresses,$("#profileHeader").html("Addresses"),e.account.addresses().length>0?$("#noAddressMsg").hide():$("#noAddressMsg").show()}s&&s()})},s=function(t,n){if(e.account.id()>0)$("select").selectmenu("refresh"),$("#addressList").listview("refresh"),t();else{var r=gdd.storage.getAccountData();r?(ko.mapping.mergeFromJS(e.account,r),$("select").selectmenu("refresh"),$("#addressList").listview("refresh"),t()):(gdd.showLoader("Loading..."),gdd.api.callApi("Person/GetPerson","GET",{personId:gdd.session.personId()},{success:function(n){gdd.hideLoader(),gdd.storage.saveAccountData(n.gddData[0]),ko.mapping.mergeFromJS(e.account,n.gddData[0]),$("select").selectmenu("refresh"),t()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))}},o=function(){$("#addressList").listview("refresh"),$(".myAddressDelete").off().on(gdd.tap(),function(){var t=$(this).attr("data-id"),n=$.grep(e.account.addresses(),function(e,n){return e.id==t});n[0].deleteMe=1,gdd.showLoader("Deleting..."),gdd.api.callApi("RefData/UpdateGeoRecord","POST",n[0],{success:function(t){gdd.hideLoader(),e.account.addresses.splice(e.account.addresses.indexOf(n[0]),1),gdd.storage.saveAccountData(ko.mapping.toJS(e.account)),e.account.addresses().length===0&&$("#noAddressMsg").show()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})})},u=function(){e.account.addresses().length>0?i(r.addresses,"left",function(){o()}):gdd.showMsg("You have no addresses loaded on the database. Let's add your first one.",function(){a()})},a=function(){gdd.pages.gmap.view.configurePageForAddressEdit(function(n){n.geoLat?(t=!0,e.newAddressAdded=1,e.newAddressToAdd.streetNumber(n.streetNumber),e.newAddressToAdd.streetName(n.streetName),e.newAddressToAdd.lat(n.geoLat),e.newAddressToAdd.lng(n.geoLng),e.newAddressToAdd.area(n.area),e.newAddressToAdd.city(n.city),e.newAddressToAdd.country(n.country),e.newAddressToAdd.postalCode(n.postalCode),e.newAddressToAdd.region(n.streetName),e.newAddressToAdd.suburb(n.suburb)):t=!1},gdd.pages.profile,null,null,2),gdd.utils.loadPage(gdd.pages.gmap,!1,"slideup")},f=function(){$(".btnProfileChurchLife").on(gdd.tap(),function(){gdd.loadPage(gdd.pages.lists,!1,"slide")}),$(".btnProfileViewGroupMembership").on(gdd.tap(),function(){gdd.loadPage(gdd.pages.groupmem,!1,"slide")}),$("#btnProfileClearDates").on(gdd.tap(),function(){e.account.unixBirthday(""),e.account.birthDay(0),e.account.birthMonth(0),e.account.birthYear(0),$("#txtAccountBirthdate").val(""),e.account.unixAnniversary(""),e.account.anniversaryDay(0),e.account.anniversaryMonth(0),e.account.anniversaryYear(0),$("#txtAccountAnniversary").val("")}),$(".profileNewAddressBack").on(gdd.tap(),function(){i(r.addresses,"down",function(){o()})}),$(".profileAddressListViewBack").on(gdd.tap(),function(){i(r.account,"right")}),$("#btnYesAddThisAddress").on(gdd.tap(),function(){t=!1,e.newAddressToAdd.type($("#ddlPAddType").val()),e.newAddressToAdd.personId(gdd.session.personId()),e.newAddressToAdd.id(-1),gdd.showLoader("Adding address..."),gdd.api.callApi("RefData/UpdateGeoRecord","POST",ko.mapping.toJS(e.newAddressToAdd),{success:function(t){gdd.hideLoader(),e.account.addresses.push(t.gddData[0]),gdd.storage.saveAccountData(ko.mapping.toJS(e.account)),$("#addressList").listview("refresh"),u()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})});var s=document.getElementById("imgProfileFb");s.onerror=function(){n==r.account&&(this.src="http://graph.facebook.com/3/picture?type=normal",e.account.facebookId()&&gdd.showMsg("The FacebookID you entered does not point to a valid facebook account. Please ensure you have entered the correct ID."))},$("#btnAddNewAddress").on(gdd.tap(),function(){a()}),$(".btnProfileAddressListView").on(gdd.tap(),function(){u()}),$("#btnUpdateAccount").on(gdd.tap(),function(){gdd.showLoader("Updating.."),gdd.api.callApi("Person/UpdatePerson","POST",ko.mapping.toJS(e.account),{success:function(t){gdd.hideLoader(),gdd.session.auth.facebookId(t.gddData[0].facebookId);var n=gdd.storage.getAuthInfo();n.facebookId=t.gddData[0].facebookId,gdd.storage.saveAuthInfo(n),gdd.storage.saveAccountData(t.gddData[0]),ko.mapping.mergeFromJS(e.account,t.gddData[0]),$("select").selectmenu("refresh")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),gdd.utils.initDatePicker("txtAccountBirthdate",function(t){t.dt?e.account.unixBirthday(t.unix):(e.account.unixBirthday(""),e.account.birthDay(0),e.account.birthMonth(0),e.account.birthYear(0))}),gdd.utils.initDatePicker("txtAccountAnniversary",function(t){t.unix?e.account.unixAnniversary(t.unix):(e.account.unixAnniversary(""),e.account.anniversaryDay(0),e.account.anniversaryMonth(0),e.account.anniversaryYear(0))})};return{newAddressToAdd:{id:ko.observable(-1),personId:ko.observable(""),country:ko.observable(""),region:ko.observable(""),city:ko.observable(""),suburb:ko.observable(""),streetNumber:ko.observable(""),streetName:ko.observable(""),postalCode:ko.observable(""),lng:ko.observable(""),lat:ko.observable(""),groupId:ko.observable(""),area:ko.observable(""),type:ko.observable("")},account:{id:ko.observable(),firstName:ko.observable(),lastName:ko.observable(),birthDay:ko.observable(),birthMonth:ko.observable(),birthYear:ko.observable(),anniversaryDay:ko.observable(),anniversaryMonth:ko.observable(),anniversaryYear:ko.observable(),email1:ko.observable(),email2:ko.observable(),mobileNumber:ko.observable(),workNumber:ko.observable(),homeNumber:ko.observable(),facebookId:ko.observable(),maritalStatus:ko.observable(),gender:ko.observable("M"),addresses:ko.observableArray(),displayBirthDate:ko.observable(),displayAnniversary:ko.observable(),unixBirthday:ko.observable(),unixAnniversary:ko.observable()},create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),f(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){s(function(){t?(t=!1,i(r.newAddress,"up")):i(r.account,"up")},function(e){gdd.showErr(e)})},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.profile.view.account.id(-1)}}}),define("views/lists",[],function(){var e=null,t=function(){var t=function(){$(".fieldFlipSwitch").flipswitch(),$(".fieldFlipSwitch").flipswitch("refresh"),$(".fieldFlipSwitch").off().on("change",function(e){var t=$(this).prop("checked"),n=$(this).attr("data-id");gdd.showLoader("Updating..."),gdd.api.callApi("Person/TogglePersonsBooleanFieldMembership","GET",{personId:gdd.session.personId(),fieldId:n,value:t},{success:function(e){gdd.hideLoader()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})})};e.fields().length>0?(t(),$.when($(".listView").not(".listContent").hide()).then(function(){$(".listContent").show("slide",{direction:"up"})})):(gdd.showLoader("Loading lists..."),gdd.api.callApi("Person/GetPersonsBooleanFieldMapping","GET",{personId:gdd.session.personId()},{success:function(n){gdd.hideLoader(),n.gddData.length>0?(e.fields.removeAll(),$.each(n.gddData,function(e,t){var n=$.grep(t.mappings,function(e,t){return e.isSubscription?!1:!0});t.mappings=n}),$.each(n.gddData,function(t,n){n.mappings.length>0&&e.fields.push(n)}),t(),$.when($(".listView").not(".listContent").hide()).then(function(){$(".listContent").show("slide",{direction:"up"})})):$.when($(".listView").not(".noListContent").hide()).then(function(){$(".noListContent").show("slide",{direction:"up"})})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))},n=function(){};return{fields:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),n(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){t()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.lists.view.fields.removeAll()}}}),define("views/messages",[],function(){var e=null,t={all:".messageView",msgList:".messageList",msgNone:".noMessages",msgReply:".msgReply"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.msgList:$("#msgHeader").html("Messages");break;case t.msgNone:$("#msgHeader").html("Messages");break;case t.msgReply:$("#msgHeader").html("Reply")}r&&r()})},r=function(){$("#myMessages").listview("refresh");var r=function(t){var n=$.grep(e.messages(),function(e,n){return e.id==t});e.selectedMsg=n[0]};$(".btnReadMsg").off().on(gdd.click(),function(t){r($(this).attr("data-id"));var n={};n.msgId=e.selectedMsg.mappingId,n.readStatus="1",n.markAllAsRead=!1,gdd.showLoader("Working..."),gdd.api.callApi("Messaging/ToggleMsgReadStatus","POST",n,{success:function(t){gdd.hideLoader();var n=$.grep(e.messages(),function(t,n){return t.id==e.selectedMsg.id});e.messages.splice(e.messages.indexOf(n[0]),1),e.messages().length===0?(gdd.showLoader("Checking messages..."),e.loadMessages(function(){gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)})):$(".messagesBubbleCount").html(e.messages().length).show()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$(".btnReplyMsg").off().on(gdd.click(),function(i){r($(this).attr("data-id")),$("#msgReplyHeader").html("A push notification will be sent to "+e.selectedMsg.sentBy+"'s mobile phone"),$("#txtMsgReplyContent").val(""),n(t.msgReply,"left")})},i=function(){$("#btnMarkAllMessagesAsRead").on(gdd.tap(),function(){var r={};r.msgId="",r.readStatus="1",r.markAllAsRead=!0,gdd.showLoader("Working..."),gdd.api.callApi("Messaging/ToggleMsgReadStatus","POST",r,{success:function(r){gdd.hideLoader(),e.messages.removeAll(),n(t.msgNone,"up"),$(".messagesBubbleCount").html("0").hide()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#btnSendMsgReply").on(gdd.tap(),function(){if($("#txtMsgReplyContent").val().length>0){var r={};r.messageType=1,e.selectedMsg.subject.indexOf("REPLY")>-1?r.subject=e.selectedMsg.subject:r.subject="REPLY: "+e.selectedMsg.subject,r.messageBody=$("#txtMsgReplyContent").val(),r.personIdList=e.selectedMsg.sendingPersonId,r.inclPersonIdList=!0,r.pushAppId=gdd.session.appInfo.split("|")[0].split(":")[1],r.sentBy=gdd.session.displayName(),r.appBadgeAction=1,r.playSound=!0,r.messageTag="Message",r.replyEnabled=!0,gdd.showLoader("Sending..."),gdd.api.callApi("Messaging/SendMessage","POST",r,{success:function(e){gdd.hideLoader(),n(t.msgList,"right")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}else gdd.showMsg("You have not entered a message to send.")}),$("#btnRefreshMessages").on(gdd.tap(),function(){e.messages.removeAll(),gdd.showLoader("Checking messages..."),e.loadMessages(function(){gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)})}),$(".btnMsgReplyBack").on(gdd.tap(),function(){n(t.msgList,"right")})};return{messagesChecked:!1,loadMessages:function(e,i){$(".messagesBubbleCount").html("").hide(),gdd.pages.messages.view.messagesChecked=!0;if(gdd.pages.messages.view.messages().length>0)$(".messagesBubbleCount").html(gdd.pages.messages.view.messages().length).show(),gdd.utils.activePage.id==gdd.pages.messages.id&&(r(),n(t.msgList,"up")),e&&e();else{var s={};s.msgId="",s.personId=gdd.session.personId(),s.viewed="0",s.count=50,s.viewPersonGlobal="1",s.matchAll="1",gdd.api.callApi("Messaging/GetMessageMappings","POST",s,{success:function(i){i.gddData.length===0?gdd.utils.activePage.id==gdd.pages.messages.id&&n(t.msgNone,"up"):(gdd.pages.messages.view.messages.removeAll(),$.each(i.gddData,function(e,t){gdd.pages.messages.view.messages.push(t)}),gdd.utils.activePage.id==gdd.pages.messages.id&&(r(),n(t.msgList,"up"))),$(".messagesBubbleCount").html(gdd.pages.messages.view.messages().length).show(),e&&e()},fail:function(e){i&&i(e.msg)}})}},selectedMsg:{},messages:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),i(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){gdd.showLoader("Checking messages..."),e.loadMessages(function(){gdd.hideLoader()},function(e){gdd.hideLoader(),gdd.showErr(e)})},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.messages.view.messages.removeAll()}}}),define("views/findachurch",[],function(){var e=null,t={all:".fcView",search:".fcSearchView",missingGeoStruc:".fcMissingGeoStruc",missingChurch:".fcMissingChurchView",searchList:".fcListView"},n=0,r=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.missingGeoStruc:$("#findachurchHeader").html("Missing Geo Data");break;case t.search:$("#findachurchHeader").html("Search");break;case t.missingChurch:$("#findachurchHeader").html("No Data");break;case t.searchList:$("#findachurchHeader").html("Results")}r&&r()})},i=function(){e.geoChurchStructure?e.geoChurchStructure.countries.length>0?(e.countriesSearch().length===0&&$.each(e.geoChurchStructure.countries,function(t,n){e.countriesSearch.push(n.name)}),r(t.search,"down")):r(t.missingGeoStruc,"up"):r(t.missingGeoStruc,"up")},s=function(t,n){var r=!1;if(e.geoChurchStructure)r=!1,t();else{var i=gdd.storage.getFacGeoStruc();i?i.countries.length>0?(r=!1,e.geoChurchStructure=i,t()):r=!0:r=!0}if(r){var s={};s.scope=0,s.entityType="Congregation",gdd.api.callApi("RefData/GetGeoStructure","POST",s,{success:function(n){gdd.hideLoader(),gdd.storage.saveFacGeoStruc(null),e.geoChurchStructure=null,n.gddData&&$.isArray(n.gddData.countries)&&n.gddData.countries.length>0&&(gdd.storage.saveFacGeoStruc(n.gddData),e.geoChurchStructure=n.gddData),t()},fail:function(e){n(e.msg)}})}},o=function(){e.countriesSearch.removeAll(),e.regionsSearch.removeAll(),e.citiesSearch.removeAll(),e.myChurchQry.country(""),e.myChurchQry.region(""),e.myChurchQry.city(""),$.each(e.geoChurchStructure.countries,function(t,n){e.countriesSearch.push(n.name)}),r(t.search,"down")},u=function(){gdd.session.signedIn()?($(".signedInModule").show(),$(".publicModule").hide()):($(".signedInModule").hide(),$(".publicModule").show()),$(".btnViewChurchAddress").off().on(gdd.click(),function(){var t=$(this).attr("data-id").split("|")[0],r=$(this).attr("data-id").split("|")[1],i=$(this).attr("data-id").split("|")[2];if(t&&r){var s=$.grep(e.churchList(),function(e,t){return e.id==i}),o="";s.length>0&&(o='<div style="width:200px; height:150px" ><strong>'+s[0].name+"</strong><div>"+s[0].geoStreetName+"</div></br><div><strong>Service Times</strong></div>",o+='<table width="100%"><th><tr><td><strong><i>Time</i></strong></td><td><strong><i>Contact</i></strong></td><td><strong><i>Tel</i></strong></td></tr></th><tbody>',$.each(s[0].services,function(e,t){o+="<tr><td>"+t.serviceTime+"</td><td>"+t.contactPerson+"</td><td>"+t.contactTelNumber+"</td></tr>"}),o+="</tbody></table></div>");var u=new Array;u.push({lat:t,lng:r,pinColor:"red",content:o}),n=1,gdd.pages.gmap.view.configureForDropPins(u),gdd.loadPage(gdd.pages.gmap,!1,"slideup")}else gdd.showMsg("No mapping data has been configured for this church.")})},a=function(){$(".fcMissingGeoStrucBack").on(gdd.tap(),function(){r(t.search,"down")}),$("#btnResetSerch").on(gdd.tap(),function(){o()}),$(".btnLinkChurchSearchMissingData").on(gdd.tap(),function(){r(t.missingGeoStruc,"up")}),$("#btnFacWhereIsMyChurch").on(gdd.tap(),function(){r(t.missingChurch,"up")}),$("#btnViewChurchesOnMap").on(gdd.tap(),function(){var t=new Array,r="";$.each(e.churchList(),function(e,n){r='<div style="width:200px; height:150px" ><strong>'+n.name+"</strong><div>"+n.geoStreetName+"</div></br><div><strong>Service Times</strong></div>",r+='<table width="100%"><th><tr><td><strong><i>Time</i></strong></td><td><strong><i>Contact</i></strong></td><td><strong><i>Tel</i></strong></td></tr></th><tbody>',$.each(n.services,function(e,t){r+="<tr><td>"+t.serviceTime+"</td><td>"+t.contactPerson+"</td><td>"+t.contactTelNumber+"</td></tr>"}),r+="</tbody></table></div>",t.push({lat:n.geoLat,lng:n.geoLng,pinColor:"red",content:r})}),n=1,gdd.pages.gmap.view.configureForDropPins(t),gdd.loadPage(gdd.pages.gmap,!1,"slideup")}),$(".btnFcListViewBack").on(gdd.tap(),function(){r(t.search,"right")}),$(".btnFacShowSearchDown").on(gdd.tap(),function(){r(t.search,"down")}),$("#btnFindChurches").on(gdd.tap(),function(){gdd.showLoader("Searching..."),gdd.api.callApi("RefData/SearchCongregations","POST",ko.mapping.toJS(e.myChurchQry),{success:function(n){gdd.hideLoader();var i=n.gddData;i.length>0?(e.churchList.removeAll(),$.each(i,function(t,n){e.churchList.push(n)}),u(),r(t.searchList,"left")):r(t.missingChurch,"up")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#ddlGeoCountry").on("change",function(){var t=$(this).val();e.regionsSearch.removeAll();if(t){e.myChurchQry.country(t);var n=$.grep(e.geoChurchStructure.countries,function(e,n){return e.name==t});$.each(n[0].regions,function(t,n){e.regionsSearch.push(n)}),$(".churchSearchRegion").show("slide",{direction:"left"})}else $.when($(".churchSearchFilter").not(".churchSearchCountry").hide("slide",{direction:"left"})).then(function(){$(".churchSearchCountry").fadeIn()});$("#ddlGeoCountry").selectmenu("refresh")}),$("#ddlGeoRegion").off().on("change",function(){var t=$(this).val();e.citiesSearch.removeAll();if(t){var n=null;e.myChurchQry.region(t),$.each(e.geoChurchStructure.countries,function(e,r){var i=$.grep(r.regions,function(e,n){return e.name==t});i.length>0&&(n=i[0])}),n&&$.each(n.cities,function(t,n){e.citiesSearch.push(n)}),$(".churchSearchCity").show("slide",{direction:"left"})}else e.myChurchQry.city(""),e.myChurchQry.region(""),$(".churchSearchCity").hide("slide",{direction:"left"});$("#ddlGeoRegion").selectmenu("refresh")}),$("#ddlGeoCity").off().on("change",function(){var t=$(this).val();t?e.myChurchQry.city(t):e.myChurchQry.city(""),$("#ddlGeoCity").selectmenu("refresh")}),$("#btnReloadGeoStructure").on(gdd.tap(),function(){e.geoChurchStructure=null,gdd.storage.saveFacGeoStruc(null),gdd.showLoader("Loading search data..."),s(function(){gdd.hideLoader(),i()},function(e){gdd.hideLoader(),gdd.showErr(e)})})};return{churchList:ko.observableArray(),myChurchQry:{country:ko.observable(""),region:ko.observable(""),city:ko.observable(""),familyId:ko.observable("")},geoChurchStructure:null,create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),a(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){n===1?(n=0,u(),r(t.searchList,"up")):(gdd.showLoader("Loading search data..."),s(function(){gdd.hideLoader(),i()},function(e){gdd.hideLoader(),gdd.showErr(e)}))},countriesSearch:ko.observableArray(),regionsSearch:ko.observableArray(),citiesSearch:ko.observableArray(),beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/missions",[],function(){var e=null,t={all:".missionsView",noMissions:".noMissions",missionList:".missionsList"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.addNew:$("#peopleHeader").html("Add New")}r&&r()})},r=function(){$("#btnReloadMissions").on(gdd.tap(),function(){e.missions.removeAll(),gdd.showLoader("Loading missions..."),i(function(){gdd.hideLoader(),e.missions().length>0?n(t.missionList,"up"):n(t.noMissions,"up")},function(e){gdd.hideLoader(),gdd.showErr(e)})})},i=function(t,n){var r=function(){gdd.session.signedIn()?($(".signedInModule").show(),$(".publicModule").hide()):($(".signedInModule").hide(),$(".publicModule").show());var t=function(t,n){gdd.showLoader("Updating..."),gdd.api.callApi("News/TogglePersonsMissionAttendance","GET",{missionId:t,personId:gdd.session.personId(),going:n},{success:function(i){gdd.hideLoader();if($.isArray(i.gddData))if(i.gddData.length>0){var s=i.gddData[0],o=$.grep(e.missions(),function(e,n){return e.missionId==t}),u=e.missions.indexOf(o[0]);e.missions.splice(u,1,s),r(),n&&gdd.showMsg("The missions co-ordinator has been notified that you would like to go on this mission.")}else gdd.showErr("The response from the server has been tempered with, please contact support.");else gdd.showErr("The response from the server has been tempered with, please contact support.")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})};$(".btnCannotGoOnMission").off().on(gdd.click(),function(){var e=$(this).attr("data-id");t(e,!1)}),$(".btnGoOnMission").off().on(gdd.click(),function(){var e=$(this).attr("data-id");t(e,!0)})},i=!1;e.missions().length>0?(i=!1,r(),t()):i=!0,i&&gdd.api.callApi("News/GetPersonsMissionProfiles","GET",{familyId:0,personId:gdd.session.personId()},{success:function(n){e.missions.removeAll(),$.isArray(n.gddData)&&n.gddData.length>0&&($.each(n.gddData,function(t,n){e.missions.push(n)}),r()),t()},fail:function(e){n(e.msg)}})};return{missions:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),r(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){gdd.showLoader("Loading missions..."),i(function(){gdd.hideLoader(),e.missions().length>0?n(t.missionList,"up"):n(t.noMissions,"up")},function(e){gdd.hideLoader(),gdd.showErr(e)})},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/secprofile",[],function(){var e=null,t=function(){if($("#txtPinfoExistPWD").val())if($("#txtPInfoUserName").val())if($("#txtPInfoNewPwd").val()){var e=$("#txtPInfoNewPwd").val().length;if(e<5)gdd.showMsg("Your new password must be at least 5 characters long");else{var t=/(?!^[0-9]*$)(?!^[a-zA-Z]*$)^([a-zA-Z0-9]{5,20})$/g,n=!1;passwordPasswed=t.test($("#txtPInfoNewPwd").val());if(!passwordPasswed)gdd.showMsg("Your new password must be at least 5 characters long and contain at least 1 number and 1 upper/lower case letter.");else if($("#txtPInfoNewPwd").val()===$("#txtPInfoConfPwd").val()){var r={oldPassword:$("#txtPinfoExistPWD").val(),newPassword:$("#txtPInfoNewPwd").val(),newUserName:$("#txtPInfoUserName").val(),userId:gdd.session.auth.userId()};gdd.showLoader("Updating..."),gdd.api.callApi("Security/UpdateUserNamePassword","POST",r,{success:function(e){gdd.hideLoader(),gdd.loadPage(gdd.utils.previousPage,!0,"slide")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}else gdd.showMsg("Your new passwords do not match.")}}else gdd.showMsg("Enter a new password.");else gdd.showMsg("Enter your username");else gdd.showMsg("Enter your existing password")},n=function(){$("#btnPInfoUpdateSec").on(gdd.tap(),function(){t()})};return{create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),n(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){}}}),define("views/managepermissions",[],function(){var e=null,t=null,n=function(n){gdd.showLoader("Working..."),gdd.api.callApi("Security/GrantPermission","GET",{requestId:t,instruction:n},{success:function(n){gdd.hideLoader();var r=$.grep(e.requests(),function(e,n){return e.id==t});e.requests.splice(e.requests.indexOf(r[0]),1),e.requests().length===0&&i()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})},r=function(){$("#btnPermReqTrusted").on(gdd.tap(),function(){$("#popupPermReqMenu").one("popupafterclose",function(e,t){n(1)}),$("#popupPermReqMenu").popup("close")}),$("#btnPermReqExecutive").on(gdd.tap(),function(){$("#popupPermReqMenu").one("popupafterclose",function(e,t){n(2)}),$("#popupPermReqMenu").popup("close")}),$("#btnPermReqPublic").on(gdd.tap(),function(){$("#popupPermReqMenu").one("popupafterclose",function(e,t){n(0)}),$("#popupPermReqMenu").popup("close")}),$("#btnPermReqDelete").on(gdd.tap(),function(){$("#popupPermReqMenu").one("popupafterclose",function(e,t){n(-1)}),$("#popupPermReqMenu").popup("close")}),$("#btnCheckForNewRequests").on(gdd.tap(),function(){e.requests.removeAll(),i()})},i=function(){var n=function(){$(".btnPermissionOption").off().on(gdd.click(),function(){t=$(this).attr("data-id"),gdd.showPopup("popupPermReqMenu",{positionTo:$(this)})})};e.requests().length>0?n():(gdd.showLoader("Loading..."),gdd.api.callApi("Security/GetPermissionRequests","GET","",{success:function(t){gdd.hideLoader(),t.gddData.length>0?($.each(t.gddData,function(t,n){e.requests.push(n)}),n()):gdd.showMsg("All pending requests have been handled.",function(){gdd.loadPage(gdd.utils.previousPage,!0,"slide")})},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))};return{requests:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),r(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){i()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.managePermissions.view.requests.removeAll()}}}),define("views/about",[],function(){var e=null,t=function(){};return{create:function(){e=this,gdd.utils.configMergeFromJs(ko),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){t(),$("#sessVersion").html(gdd.session.appInfo.split("|")[1].split(":")[1]),$("#sessDb").html(gdd.portalName()+"("+gdd.portalId()+")"),$("#sessUser").html(gdd.session.auth.userName()+"("+gdd.session.auth.userId()+")");var e="";gdd.utils.isAndroid()?e="Android (Google)":e="iOS (Apple)",$("#sessOs").html(e)},beforeShow:function(){},beforeHide:function(){}}}),define("views/sessioninfo",[],function(){var e=null,t=function(){};return{create:function(){e=this,gdd.utils.configMergeFromJs(ko),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){t(),$("#sessVersion").html(gdd.session.appInfo.split("|")[1].split(":")[1]),$("#sessDb").html(gdd.portalName()+"("+gdd.portalId()+")"),$("#sessUser").html(gdd.session.auth.userName()+"("+gdd.session.auth.userId()+")");var e="";gdd.utils.isAndroid()?e="Android (Google)":e="iOS (Apple)",$("#sessOs").html(e)},beforeShow:function(){},beforeHide:function(){}}}),define("views/give",[],function(){var e=null,t={all:".givingView",givingViaWeb:".givingViewViaWeb",giveOne:".givingViewOne",giveTwo:".givingViewTwo",giveThree:".givingViewThree",giveInActive:".givingViewInActive"},n=function(t,n){var r=!0,i="";if(e.myPledge.type()=="1"){e.myPledge.accNumber()||(r=!1,i="You must provide us with a valid credit card number."),e.myPledge.accName()||(r=!1,i="You must provide us with the name on your credit card.");if(!$.isNumeric(e.myPledge.cvc()))r=!1,i="Please enter a valid cvc number.";else if(e.myPledge.cvc()<0)r=!1,i="Please enter a valid cvc number.";else if(e.myPledge.cvc().length<3||e.myPledge.cvc().length>4)r=!1,i="Please enter a valid cvc number."}else e.myPledge.accNumber()||(r=!1,i="You must provide us with the bank account number."),e.myPledge.accName()||(r=!1,i="You must provide us with the name of the bank account."),e.myPledge.branchCode()||(r=!1,i="Please enter the branch code of the bank account.");r?t():n(i)},r=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){$("#giveHeaderText").html("Give");switch(e){case t.giveOne:$("#giveHeaderText").html("1 of 3");break;case t.giveTwo:$("#giveHeaderText").html("2 of 3");break;case t.giveThree:$("#giveHeaderText").html("3 of 3");break;case t.giveInActive:$("#giveHeaderText").html("Give");break;case t.givingViaWeb:$("#giveHeaderText").html("Give")}r&&r()})},i=function(){$("#btnGiveRefreshProfile").on(gdd.tap(),function(){e.pledgeTemplate.funds.removeAll(),s()}),$(".giveTwoBackToOne").on(gdd.tap(),function(){r(t.giveOne,"right")}),$(".giveTwoGoToThree").on(gdd.tap(),function(){$.isNumeric(e.myPledge.amount())&&e.myPledge.amount()>0?(e.myPledge.type()=="1"?($(".giveViewDebitOrder").hide(),$(".giveViewCreditCard").show()):($(".giveViewDebitOrder").show(),$(".giveViewCreditCard").hide()),r(t.giveThree,"left")):gdd.showMsg("You have not entered a valid pledge amount. The amount must be a positive numerical amount.")}),$(".giveEditCancel").on(gdd.tap(),function(){r(t.giveOne,"right")}),$("#ddlPledgeType").on("change",function(){$(this).val()=="2"&&(e.myPledge.ccy("ZAR"),$("select").selectmenu("refresh"))}),$(".giveThreeBackToTwo").on(gdd.tap(),function(){r(t.giveTwo,"right")}),$(".giveThreeConfirm").on(gdd.tap(),function(){n(function(){gdd.showPopup("popupPledgeConfirm")},function(e){gdd.showMsg(e)})}),$("#btnUpdatePledge").on(gdd.tap(),function(){n(function(){gdd.showPopup("popupGiveAgree")},function(e){gdd.showMsg(e)})}),$("#btnGiveIAgree").on(gdd.click(),function(){$("#popupGiveAgree").one("popupafterclose",function(){e.myPledge.personId(gdd.session.personId()),e.myPledge.pledgeCode(e.pledgeTemplate.pledgeCode()),gdd.showLoader("Saving pledge..."),gdd.api.callApi("Financial/CaptureRemotePledge","POST",ko.mapping.toJS(gdd.pages.give.view.myPledge),{success:function(e){gdd.hideLoader();var t=e.gddData[0];$("#popupPledgeThankYouMessage").one("popupafterclose",function(e,t){gdd.loadPage(gdd.utils.previousPage,!0,"slide")}),gdd.showPopup("popupPledgeThankYouMessage")},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}})}),$("#popupGiveAgree").popup("close")}),$("#btnGiveNotAgree").on(gdd.click(),function(){$("#popupGiveAgree").one("popupafterclose",function(){gdd.showMsg("You must agree to the terms and conditions before we can process this request.")}),$("#popupGiveAgree").popup("close")}),$("#ddlPledgeCcy").on("change",function(){$(this).val()!="ZAR"&&e.myPledge.type()!="1"&&gdd.showMsg("To pledge using a currency other than 'ZAR' requires a Credit Card.",function(){e.myPledge.type("1"),$("select").selectmenu("refresh")})})},s=function(){var n=function(){$("#giveFundList").listview("refresh"),$(".fundItem").off().on(gdd.click(),function(){var n=$(this).attr("data-id").split("|")[0],i=$(this).attr("data-id").split("|")[1];$(".selectedFundName").html(i),e.myPledge.fundId(n),r(t.giveTwo,"left")}),$("select").selectmenu("refresh")},i=function(){n();if(e.pledgeTemplate.isActive())switch(e.pledgeTemplate.redirectToWebUrl()){case 1:if(gdd.utils.isNative())try{$("#btnGiveViaWeb").attr("href","#").removeAttr("target"),$("#btnGiveViaWeb").one(gdd.click(),function(){try{window.open(e.pledgeTemplate.redirectUrl(),"_system","location=yes,closebuttoncaption=Done/Close")}catch(t){gdd.showErr("We cannot load the browser on this device: "+t)}})}catch(i){gdd.showErr("We cannot load the browser on this device: "+i)}else $("#btnGiveViaWeb").attr("href",e.pledgeTemplate.redirectUrl()).attr("target","_blank");r(t.givingViaWeb,"up");break;case 2:gdd.showMsg(e.pledgeTemplate.redirectMsg(),function(){e.pledgeTemplate.funds.removeAll(),gdd.loadPage(gdd.utils.previousPage,!0,"slide")});break;default:r(t.giveOne,"up")}else r(t.giveInActive,"up")};if(e.pledgeTemplate.funds().length>0)i();else{gdd.showLoader("Configuring...");var s={};s.pledgeCode="",s.personId=gdd.session.personId(),gdd.utils.isNative()?gdd.utils.isAndroid()?s.platform=2:s.platform=1:s.platform=0,gdd.api.callApi("Financial/GetPledgeTemplate","POST",s,{success:function(t){gdd.hideLoader(),ko.mapping.mergeFromJS(e.pledgeTemplate,t.gddData),i()},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg,function(){gdd.loadPage(gdd.utils.previousPage,!0,"slide")})}})}};return{pledgeTemplate:{isActive:ko.observable(!1),inActiveReason:ko.observable(""),id:ko.observable(-1),portalId:ko.observable(""),portalName:ko.observable(""),title:ko.observable(""),description:ko.observable(""),agreeTo:ko.observable(""),thankYouText:ko.observable(""),userChanged:ko.observable(""),dateChanged:ko.observable(""),pledgeCode:ko.observable(""),personalInfoHeader:ko.observable(""),fundInfoHeader:ko.observable(""),bankDetails:ko.observable(""),bankingInstructions:ko.observable(""),funds:ko.observableArray(),ccTypes:ko.observableArray(),frequencies:ko.observableArray(),ccy:ko.observableArray(),accTypes:ko.observableArray(),redirectMsg:ko.observable(""),redirectUrl:ko.observable(""),redirectToWebUrl:ko.observable(!1)},myPledge:{personId:ko.observable(-1),firstName:ko.observable(""),lastName:ko.observable(""),email:ko.observable(""),telNumber:ko.observable(""),fundId:ko.observable(""),type:ko.observable("1"),accName:ko.observable(""),ccType:ko.observable(""),amount:ko.observable(""),expMonth:ko.observable("01"),expYear:ko.observable("2018"),accNumber:ko.observable(""),frequency:ko.observable("Monthly"),ccy:ko.observable("ZAR"),cvc:ko.observable(""),branchCode:ko.observable(""),debitDay:ko.observable("1"),pledgeCode:ko.observable(""),accTypeId:ko.observable("")},create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),i(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){s()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.give.view.pledgeTemplate.funds.removeAll()}}}),define("views/groupmem",[],function(){var e=null,t={all:".grpMemView",none:".noGrpMem",membership:".grpMem"},n=function(e,n,r){gdd.utils.slideTransitionView($(t.all),$(e),n,function(){switch(e){case t.addNew:$("#peopleHeader").html("Add New")}r&&r()})},r=function(){},i=function(){e.membership().length>0?n(t.membership,"up"):(gdd.showLoader("Loading..."),gdd.api.callApi("Groups/GetPersonsGroupMembershipHistory","GET",{personId:gdd.session.personId()},{success:function(r){gdd.hideLoader();try{r.gddData.length===0?n(t.none,"up"):(e.membership.removeAll(),$.each(r.gddData,function(t,n){e.membership.push(n)}),n(t.membership,"up"))}catch(i){n(t.none,"up")}},fail:function(e){gdd.hideLoader(),gdd.showErr(e.msg)}}))};return{membership:ko.observableArray(),create:function(){e=gdd.utils.activePage.view,gdd.utils.configMergeFromJs(ko),r(),ko.applyBindings(gdd,document.getElementById(gdd.utils.activePage.id))},show:function(){i()},beforeShow:function(){},beforeHide:function(){},endOldSession:function(){gdd.pages.groupmem.view.membership.removeAll()}}}),define("views/views",["views/signin","views/index","views/moreInfo","views/home","views/portals","views/news","views/subs","views/people","views/groups","views/gmap","views/requestpermission","views/events","views/payment","views/sermons","views/profile","views/lists","views/messages","views/findachurch","views/missions","views/secprofile","views/managepermissions","views/about","views/sessioninfo","views/give","views/groupmem"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T){var N="Your account does not have the required permission to access this page. Please contact your church office.";return{getPageById:function(e){for(var t in gdd.pages)if(typeof gdd.pages[t]=="object"&&gdd.pages[t].hasOwnProperty("id")&&gdd.pages[t].id==e)return gdd.pages[t]},index:{id:"pg_index",path:"index.html",loginState:1,view:t,permitted:function(){return!0},deniedMsg:N},signin:{id:"pg_signin",path:"signin.html",loginState:1,view:e,permitted:function(){return!0},deniedMsg:N},people:{id:"pg_people",path:"people.html",loginState:3,view:u,permitted:function(){return gdd.session.activeSession.permissions.viewOthersAccountInfo},deniedMsg:"Your account is not permitted to access other people's information."},managePermissions:{id:"pg_managepermissions",path:"managepermissions.html",loginState:3,view:w,permitted:function(){return gdd.session.activeSession.permissions.manageSecProfiles},deniedMsg:"You are not permitted to manage security profiles in this database."},groupmem:{id:"pg_groupmem",path:"groupmem.html",loginState:3,view:T,permitted:function(){return!0},deniedMsg:"You are not permitted to view group membership in this database."},events:{id:"pg_events",path:"events.html",loginState:3,view:c,permitted:function(){return!0},deniedMsg:N},give:{id:"pg_give",path:"give.html",loginState:3,view:x,permitted:function(){return!0},deniedMsg:N},about:{id:"pg_about",path:"about.html",loginState:3,view:E,permitted:function(){return!0},deniedMsg:N},sessionInfo:{id:"pg_sessioninfo",path:"sessioninfo.html",loginState:3,view:S,permitted:function(){return!0},deniedMsg:N},lists:{id:"pg_lists",path:"lists.html",loginState:3,view:v,permitted:function(){return!0},deniedMsg:N},findachurch:{id:"pg_findachurch",path:"findachurch.html",loginState:3,view:g,permitted:function(){return!0},deniedMsg:N},secProfile:{id:"pg_secprofile",path:"secprofile.html",loginState:3,view:b,permitted:function(){return!0},deniedMsg:N},missions:{id:"pg_missions",path:"missions.html",loginState:3,view:y,permitted:function(){return!0},deniedMsg:N},messages:{id:"pg_messages",path:"messages.html",loginState:3,view:m,permitted:function(){return!0},deniedMsg:N},profile:{id:"pg_profile",path:"profile.html",loginState:3,view:d,permitted:function(){return!0},deniedMsg:N},payment:{id:"pg_payment",path:"payment.html",loginState:3,view:h,permitted:function(){return!0},deniedMsg:N},requestPermission:{id:"pg_requestpermission",path:"requestpermission.html",loginState:3,view:l,permitted:function(){return!0},deniedMsg:N},gmap:{id:"pg_gmap",path:"gmap.html",loginState:3,view:f,permitted:function(){return!0},deniedMsg:N},groups:{id:"pg_groups",path:"groups.html",loginState:3,view:a,permitted:function(){return!0},deniedMsg:N},subs:{id:"pg_subs",path:"subs.html",loginState:1,view:o,permitted:function(){return!0},deniedMsg:N},sermons:{id:"pg_sermons",path:"sermons.html",loginState:3,view:p,permitted:function(){return!0},deniedMsg:N},moreInfo:{id:"iii",path:"moreInfo.html",loginState:1,view:n,permitted:function(){return!0},deniedMsg:N},home:{id:"pg_news",path:"news.html",loginState:3,view:s,permitted:function(){return!0},deniedMsg:N},portals:{id:"pg_portals",path:"portals.html",loginState:3,view:i,permitted:function(){return!0},deniedMsg:N},news:{id:"pg_news",path:"news.html",loginState:3,view:s,permitted:function(){return!0},deniedMsg:N}}}),define("global/session",[],function(){return{loadForPublicAccess:function(e,t){gdd.session.activeSession.portalId(e),gdd.session.activeSession.portalName(t),gdd.storage.savePublicAccessToken({portalId:e,portalName:t})},startProfile:{mobiVersionStopMsg:ko.observable(""),mobiVersionNoticeMsg:ko.observable(""),baseApiUrl:ko.observable(""),showMobiVersionNoticeMsg:ko.observable(!1),showMobiVersionStopMsg:ko.observable(!1),timeChecked:null,forceRegistration:ko.observable(!1)},auth:{authKey:ko.observable(""),authorizedPortals:ko.observableArray(),displayName:ko.observable(""),facebookId:ko.observable(""),globalSettings:{googleGdcProjectId:ko.observable("")},personId:ko.observable(""),sts:ko.observable(""),userId:ko.observable(""),userName:ko.observable("")},activeSession:{notice:ko.observable(""),permissions:{},portalId:ko.observable(""),portalLabels:{},portalName:ko.observable(""),portalSettings:{},sessionKey:ko.observable("")},baseApiUrl:"",sessionKey:function(){return gdd.session.activeSession?gdd.session.activeSession.sessionKey()?gdd.session.activeSession.sessionKey():"":""},authKey:function(){return gdd.session.auth?gdd.session.auth.authKey()?gdd.session.auth.authKey():"":""},apiKey:"39251c1b-7585-476e-a69f-bbee4d17dd63",signOut:function(){gdd.storage.signOut(),gdd.session.auth.authKey(""),gdd.session.auth.authorizedPortals.removeAll(),gdd.session.auth.displayName(""),gdd.session.auth.facebookId(""),gdd.session.auth.globalSettings.googleGdcProjectId(""),gdd.session.auth.personId(""),gdd.session.auth.sts(""),gdd.session.auth.userId(""),gdd.session.auth.userName(""),gdd.session.endOldSession(),gdd.session.activeSession.permissions={},gdd.session.activeSession.portalId(""),gdd.session.activeSession.portalLabels={},gdd.session.activeSession.portalName(""),gdd.session.activeSession.portalSettings={},gdd.session.activeSession.sessionKey(""),gdd.loadPage(gdd.pages.signin,!1,"slideup")},endOldSession:function(){gdd.session.pushDeviceId=null,gdd.session.activeSession.sessionKey("");for(var e in gdd.pages)typeof gdd.pages[e]=="object"&&gdd.pages[e].hasOwnProperty("view")&&gdd.pages[e].view.hasOwnProperty("endOldSession")&&gdd.pages[e].view.endOldSession()},startNewSession:function(){var e=gdd.storage.getSessionInfo();gdd.storage.saveSessionInfo(e),ko.mapping.mergeFromJS(gdd.session.activeSession,e),gdd.session.activeSession.permissions=e.permissions,gdd.session.activeSession.portalLabels=e.portalLabels,gdd.session.activeSession.portalSettings=e.portalSettings,gdd.utils.applyModuleVisibility(),gdd.utils.buildLabelObject(),gdd.loadPage(gdd.pages.home)},appInfo:null,personId:function(){return gdd.session.signedIn()?gdd.session.auth.personId():0},pushDeviceId:null,displayName:ko.pureComputed(function(){return gdd.session.auth.displayName()},this),fbLg:ko.pureComputed(function(){return"http://graph.facebook.com/"+gdd.session.auth.facebookId()+"/picture?type=large"},this),fbMd:ko.pureComputed(function(){return"http://graph.facebook.com/"+gdd.session.auth.facebookId()+"/picture?type=normal"},this),fbSm:ko.pureComputed(function(){return"http://graph.facebook.com/"+gdd.session.auth.facebookId()+"/picture?type=small"},this),authorized:function(){return!0},signedIn:function(){if(gdd.session.activeSession.sessionKey())return!0;var e=gdd.storage.getSessionInfo();return e?gdd.session.activeSession.sessionKey()?(gdd.session.startNewSession(),!0):!1:!1}}}),define("global/utils",[],function(){return{loadGoogleJsonApi:function(e,t){typeof google!="object"?$.getScript("http://www.google.com/jsapi?key=AIzaSyCLeCaHg4_SjCQaiF8PXVhZ0VHlwLjMQvY").done(function(t,n){e()}).fail(function(e,n,r){t("We were not able to configure Google Json Api. This is most likely due to internet connectivity.")}):e()},loadGoogleMapsApi:function(e,t){gdd.utils.loadGoogleJsonApi(function(){if(typeof google.maps!="object")try{gmapsApiLoaded=function(){e()};try{google.load("maps","3",{callback:gmapsApiLoaded,other_params:"sensor=false"})}catch(n){t(n)}}catch(r){t(r)}else e()},function(e){t(e)})},deviceIsReady:!1,tap:"tap",click:"click",activePage:null,previousPage:null,requestPermission:function(e){gdd.pages.requestPermission.view.msg(e),gdd.loadPage(gdd.pages.requestPermission)},showMsg:function(e,t){$("#glbMsgContent").html(e),$("#globalMessage").popup("open",{transition:"pop"}),t&&$("#globalMessage").one("popupafterclose",function(e,n){t()})},showPopup:function(e,t,n){if(t)t.transition="slideup";else var t={transition:"slideup"};$("#"+e).popup("open",t),n&&$("#"+e).one("popupafterclose",function(e,t){n()})},showWarning:function(e,t){$("#glbWarningMsgContent").html(e),$("#globalWarningMessage").popup("open",{transition:"pop"}),t&&$("#globalWarningMessage").one("popupafterclose",function(e,n){t()})},showErr:function(e,t){$("#glbErrMsgContent").html(e),$("#globalErrorMessage").popup("open",{transition:"pop"}),t&&$("#globalErrorMessage").one("popupafterclose",function(e,n){t()})},loadPage:function(e,t,n){if(e.permitted()){e||(e=gdd.pages.home);var r=function(){return gdd.utils.activePage?gdd.utils.activePage.id!==e.id?!0:!1:!0},i=function(){var e={};return n?t?{transition:n,reverse:!0}:{transition:n}:t?{transition:"slide",reverse:!0}:{transition:"slide"}};r()?this.isOnline()&&this.appReady()?(this.previousPage=this.activePage,this.activePage=e,gdd.utils.isNative()?$("body").pagecontainer("change",gdd.utils.renderPagePath(e.path),i()):location.href.indexOf("local")>-1?$("body").pagecontainer("change",gdd.utils.renderPagePath(e.path),i()):$("body").pagecontainer("change",gdd.utils.renderPagePath(e.path),i()),gdd.utils.push.configure(),gdd.pages.news.view.newsItems().length>0&&gdd.utils.notice.checkForNew(function(){gdd.utils.checkMessages()})):gdd.showMsg("It does not appear that you are connected to the internet. Please reconnect and click 'OK' to try again.",function(){gdd.utils.restartApp()}):($("#appMenuPanel").panel("close"),$("#appSettingsPanel").panel("close"),gdd.hideLoader())}else gdd.utils.requestPermission(e.deniedMsg)},renderPagePath:function(e){return gdd.utils.isNative()?e:location.href.indexOf("local")>-1||location.href.indexOf("41")>-1?e:"http://m.godochurch.com/m/"+e},configMergeFromJs:function(e){e.mapping.mergeFromJS=function(t,n){for(var r in n)t.hasOwnProperty(r)?typeof t[r]=="object"?e.mapping.mergeFromJS(t[r],n[r]):typeof t[r]=="function"&&(e.isComputed(t[r])||t[r](n[r])):t[r]=n[r]}},checkMessages:function(){gdd.session.signedIn()&&(gdd.pages.messages.view.messagesChecked||gdd.pages.messages.view.loadMessages())},isOnline:function(){return window.navigator.onLine?!0:!1},hideLoader:function(){$.mobile.loading("hide")},showLoader:function(e){$.mobile.loading("show",{text:e,textVisible:!0,theme:"f",html:""})},isNative:function(){return document.URL.indexOf("http://")===-1&&document.URL.indexOf("https://")===-1?!0:!1},deviceIsReady:!1,appInitialized:!1,appReady:function(){return this.isNative()?this.deviceIsReady?gdd?this.appInitialized?!0:!1:!1:!1:gdd?this.appInitialized?!0:!1:!1},restartApp:function(){window.gddAppRestart()},phoneGap:{timePaused:null,onAppPause:function(){gdd.utils.phoneGap.timePaused=gdd.utils.getDt().unix},onAppResume:function(){},onBackKeyDown:function(e){e.preventDefault();try{if(gdd.utils.previousPage){var t=new Array;t.push("pg_gmap"),t.push("pg_index"),t.indexOf(gdd.utils.previousPage.id)===-1?gdd.loadPage(gdd.utils.previousPage,!0,"slide"):gdd.loadPage(gdd.pages.home,!0,"slide")}}catch(n){location.href="index.html"}},onDeviceReady:function(){try{gdd.utils.deviceIsReady=!0;try{StatusBar.overlaysWebView(!1),StatusBar.hide()}catch(e){}setTimeout(function(){navigator.splashscreen.hide()},1e3),document.addEventListener("pause",gdd.utils.phoneGap.onAppPause,!1),document.addEventListener("resume",gdd.utils.phoneGap.onAppResume,!1),document.addEventListener("backbutton",gdd.utils.phoneGap.onBackKeyDown,!1)}catch(t){alert("The following error occured during the onDeviceReady event: "+t+". Please check you are connected to the Internet and try again.")}}},notice:{checkForNew:function(e){var t=!1;if(gdd.session.signedIn()){var n=gdd.utils.getDt();if(gdd.utils.notice.lastChecked)try{n.unix-gdd.utils.notice.lastChecked>86400?t=!0:t=!1}catch(r){t=!0}else t=!0}t?gdd.api.callApi("Person/GetPersonsNotice","GET","",{success:function(t){e(),gdd.utils.notice.lastChecked=n.unix;if(t.gddData.length>0){$("#glbMsgDidYouKnow").html(t.gddData[0].message);var r=t.gddData[0].noticeId;gdd.showPopup("globalDidYouKnow",null,function(){gdd.api.callApi("Person/ToggleNoticeRead","GET",{noticeId:r,read:!0},{success:function(e){},fail:function(e){gdd.showErr(e.msg)}})})}},fail:function(t){e(),gdd.showErr(t.msg)}}):e()},lastChecked:null},isAndroid:function(){return gdd.utils.isNative()?device.platform=="android"||device.platform=="Android"?!0:!1:!1},isIos:function(){return gdd.utils.isNative()?device.platform=="iOS"?!0:!1:!1},applyModuleVisibility:function(){gdd.session.startProfile.showMobiVersionStopMsg()?($("#appStopMessage").show(),$("#appNoticeMessage").hide(),$("#appStopMessage").html(gdd.session.startProfile.mobiVersionStopMsg())):($("#appStopMessage").hide(),gdd.session.startProfile.showMobiVersionNoticeMsg()?($("#appNoticeMessage").show(),$("#appNoticeMessage").html(gdd.session.startProfile.mobiVersionNoticeMsg())):$("#appNoticeMessage").hide()),gdd.session.signedIn()?($(".signedInModule").show(),$(".publicModule").hide(),gdd.session.activeSession.portalSettings.missionsIsActive?$(".missionsModule").show():$(".missionsModule").hide(),gdd.session.activeSession.portalSettings.findAChurchsIsActive?$(".findAChurchModule").show():$(".findAChurchModule").hide(),gdd.session.activeSession.portalSettings.searchPersonIsActive?$(".searchPeopleModule").show():$(".searchPeopleModule").hide(),gdd.session.activeSession.portalSettings.groupsIsActive?$(".groupsModule").show():$(".groupsModule").hide(),gdd.session.activeSession.permissions.manageSecProfiles?$(".mngPermissionsModule").show():$(".mngPermissionsModule").hide(),gdd.session.activeSession.portalSettings.sermonsIsActive?$(".sermonsModule").show():$(".sermonsModule").hide(),gdd.session.activeSession.portalSettings.workflowsIsActive?$(".workflowModule").show():$(".workflowModule").hide(),gdd.session.activeSession.portalSettings.followUpIsActive?$(".followUpModule").show():$(".followUpModule").hide(),gdd.session.activeSession.portalSettings.customListsIsActive?$(".customListsModule").show():$(".customListsModule").hide(),gdd.session.activeSession.portalSettings.eventsIsActive?$(".eventsModule").show():$(".eventsModule").hide(),gdd.session.activeSession.portalSettings.newsIsActive?$(".newsModule").show():$(".newsModule").hide(),gdd.session.activeSession.portalSettings.kidsChurchIsActive?$(".kidsChurchModule").show():$(".kidsChurchModule").hide(),gdd.session.activeSession.portalSettings.givingIsActive?$(".givingModule").show():$(".givingModule").hide()):($(".signedInModule").hide(),$(".publicModule").show())},appStart:function(){$("#idxContent").hide(),gdd.showLoader("Establishing connection..."),gdd.utils.getAppConfig(function(){gdd.hideLoader();try{var e=gdd.storage.getAuthInfo();if(e){ko.mapping.mergeFromJS(gdd.session.auth,e);var t=gdd.storage.getSessionInfo();if(t){gdd.utils.appInitialized=!0;if(gdd.utils.appReady())gdd.session.startNewSession();else var n=0,r=setInterval(function(){i()},500),i=function(){gdd.utils.appReady()?(clearInterval(r),gdd.hideLoader(),gdd.session.startNewSession()):(n+=1,n>10?(clearInterval(r),gdd.hideLoader(),gdd.showMsg("There appears to be a connectivity problem with the app. Please click the OK button below to force a reset.",function(){location.href=gdd.utils.renderPagePath("index.html")})):gdd.showLoader("Connecting..."+n+"/10"))}}else gdd.utils.appInitialized=!0,gdd.loadPage(gdd.pages.signin)}else{var s=gdd.storage.getPublicAccessToken();s?(gdd.session.loadForPublicAccess(s.portalId,s.portalName),gdd.utils.appInitialized=!0,gdd.loadPage(gdd.pages.home)):(gdd.storage.saveSessionInfo(null),gdd.session.endOldSession(),gdd.utils.appInitialized=!0,gdd.loadPage(gdd.pages.signin))}}catch(o){gdd.storage.saveSessionInfo(null),gdd.session.endOldSession(),gdd.utils.appInitialized=!0,gdd.loadPage(gdd.pages.signin)}},function(e){gdd.hideLoader(),$("#idxContentMsg").html(e),$("#idxContent").fadeIn()}),gdd.utils.configMergeFromJs(ko),this.isNative()?(gdd.utils.deviceIsReady=!1,document.addEventListener("deviceready",gdd.utils.phoneGap.onDeviceReady,!1)):gdd.utils.deviceIsReady=!0,$("#globalErrorMessage").show(),$("#globalWarningMessage").show(),$("#globalMessage").show(),$("#popupSettings").show(),$("#globalDidYouKnow").show(),$("#globalDidYouKnow").enhanceWithin().popup(),$("#globalErrorMessage").enhanceWithin().popup(),$("#globalMessage").enhanceWithin().popup(),$("#globalWarningMessage").enhanceWithin().popup(),$("#popupSettings").enhanceWithin().popup(),$("#appMenuPanel").enhanceWithin().panel().show(),$("#appSettingsPanel").enhanceWithin().panel().show()},initDatePicker:function(e,t){$("#"+e).datepicker({defaultDate:"+1w",changeYear:"true",yearRange:"-90:+1",changeMonth:!0,dateFormat:gdd.utils.dateDisplayFormat,numberOfMonths:1,onClose:function(e){if(e){var n=$(this).datepicker("getDate"),r={};r.unix=gdd.utils.sysDate(n),r.display=gdd.utils.displayDate(n),r.dt=n,t(r)}else{var r={};r.unix="",r.display="",r.dt="",t(r)}}})},slideTransitionView:function(e,t,n,r){var i="up";switch(n){case"up":i="down";break;case"left":i="right";break;case"right":i="left";break;case"down":i="up"}$.when($(e).not($(t)).hide("slide",{direction:n})).then(function(){$.when($(t).show("slide",{direction:i})).then(function(){r&&r()})})},push:{updateDeviceIdOnServer:function(e,t){var n={deviceId:e,osType:t,personId:gdd.session.personId()};gdd.api.callApi("Security/UpdateUsersDeviceID","GET",n,{success:function(t){gdd.session.pushDeviceId=e},fail:function(e){gdd.utils.push.pluginError(e.msg)}})},android:{onNotification:function(e){switch(e.event){case"registered":e.regid.length>0&&gdd.utils.push.updateDeviceIdOnServer(e.regid,"2");break;case"message":var t={};t.message="",e.payload&&(e.payload.message&&(t.message=e.payload.message),e.payload.title,e.payload.sentBy,e.payload.linkMore),gdd.utils.push.messageReceived(t);break;case"error":gdd.utils.push.pluginError("Google Cloud Messaging incurred the following error: "+e.msg);break;default:gdd.utils.push.pluginError("An unknown error has occurred on Google Cloud Messaging")}}},iOs:{tokenHandler:function(e){gdd.utils.push.updateDeviceIdOnServer(e,"1")},onNotification:function(e){var t={};t.message="",e.alert&&(t.message=e.alert);if(e.sound){var n=new Media(e.sound);n.play()}if(e.badge){var r=window.plugins.pushNotification;r.setApplicationIconBadgeNumber(gdd.utils.push.pluginSuccess,gdd.utils.push.pluginError,e.badge)}gdd.utils.push.messageReceived(t)}},pluginSuccess:function(e){},pluginError:function(e){gdd.showErr("Push Plugin Error: "+e)},messageReceived:function(e){try{gdd.pages.messages.view.messagesChecked=!1,gdd.pages.messages.view.messages.removeAll(),gdd.utils.checkMessages()}catch(t){}},configure:function(){if(gdd.session.signedIn()&&gdd.utils.isNative()&&gdd.session.signedIn()&&!gdd.session.pushDeviceId&&window.plugins&&window.plugins.pushNotification&&device)if(gdd.utils.isAndroid())try{var e=window.plugins.pushNotification,t=gdd.session.auth.globalSettings.googleGdcProjectId();e.register(gdd.utils.push.pluginSuccess,gdd.utils.push.pluginError,{senderID:t,ecb:"gdd.utils.push.android.onNotification"})}catch(n){gdd.utils.push.pluginError("The following error was generated while trying to register the device with Google Cloud Messaging: "+n)}else if(gdd.utils.isIos())try{var r=window.plugins.pushNotification;r.register(gdd.utils.push.iOs.tokenHandler,gdd.utils.push.pluginError,{badge:"true",sound:"true",alert:"true",ecb:"gdd.utils.push.iOs.onNotification"})}catch(n){gdd.utils.push.pluginError("The following error was generated while trying to register the device with Apples Push Notification services: "+n)}}},sysDate:function(e){return e?e.getTime()/1e3:(new Date).getTime()/1e3},months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dateDisplayFormat:"dd-M-yy",displayDate:function(e){return e||(e=new Date),e.getDate()+"-"+gdd.utils.months[e.getMonth()]+"-"+e.getFullYear()},getDt:function(e){var t={},n=new Date;if(e)if(e>0){var r=new Date(n.getTime()+864e5*e);t.unix=gdd.utils.sysDate(r),t.display=gdd.utils.displayDate(r)}else e*=-1,r=new Date(n.getTime()-864e5*e),t.unix=gdd.utils.sysDate(r),t.display=gdd.utils.displayDate(r);else t.unix=gdd.utils.sysDate(n),t.display=gdd.utils.displayDate(n);return t},getAppConfig:function(e,t){if(gdd.session.startProfile.timeChecked){var n=gdd.utils.getDt(),r=gdd.session.startProfile.timeChecked,i=n.unix-r;i>86300&&(gdd.session.startProfile.timeChecked=null)}gdd.session.startProfile.timeChecked?e():gdd.api.callApi("Open/GetStartProfile","GET","",{success:function(t){ko.mapping.mergeFromJS(gdd.session.startProfile,t.gddData),gdd.session.baseApiUrl=t.gddData.baseApiUrl,gdd.session.startProfile.timeChecked=gdd.utils.getDt().unix,e()},fail:function(e){t(e.msg)}},{timeout:15e3})},buildLabelObject:function(){var e=gdd.session.activeSession.portalLabels,t={};$.each(e,function(e,n){t[n.code.toString()]=n.title}),gdd.labels=t}}}),define("global/api",[],function(){var e=function(){return gdd.session.baseApiUrl?gdd.session.baseApiUrl:"http://api.gododata.com/webapi2/api/"},t=function(){var e=gdd.session.appInfo;gdd.session.signedIn()||gdd.session.activeSession.portalId()&&(e=e+"|portalid:"+gdd.session.activeSession.portalId());var t=gdd.session.sessionKey();if(t)return{apiKey:gdd.session.apiKey,usrKey:t,appInfo:e};var n=gdd.session.authKey();return n?{apiKey:gdd.session.apiKey,usrKey:n,appInfo:e}:{apiKey:gdd.session.apiKey,usrKey:"",appInfo:e}};return{callApi:function(n,r,i,s,o){$.support.cors=!0,o||(o={}),o.timeout||(o.timeout=3e4);if(!s.success||!s.fail)throw"You must provide a valid callback for 'success' and 'failed'";var u=e()+n;$.ajax(u,{type:r,headers:t(),data:i,timeout:o.timeout,complete:function(e,t){var n={};n.status=e.status;if(e.responseJSON)n.gdd=e.responseJSON;else{if(!e.responseText){n.status===404?(n.gdd=n.gdd||{},n.gdd.msg="HTTP ERROR: You are not permitted to access this api endpoint. If you think this is an error please contact support."):n.status=="0"?(n.gdd=n.gdd||{},n.gdd.msg="INTERNET CONNECTION: We cannot contact the server. Either your internet connection has been lost or the server is not responding. Please reconnect and try again."):(n.gdd=n.gdd||{},n.gdd.msg="The response from the server has been tampered with. Please contact support."),s.fail(n.gdd);return}try{n.gdd=JSON.parse(e.responseText)}catch(r){n.gdd=n.gdd||{},n.gdd.msg="The response from the server has been tampered with. Please contact support.",s.fail(n.gdd);return}}if(n.status===404||n.status=="0")n.gdd=n.gdd||{},n.gdd.msg="HTTP ERROR: You are not permitted to access this api endpoint. If you think this is an error please contact support.",s.fail(n.gdd);else if(n.gdd.code)switch(n.gdd.code){case 1e3:s.success(n.gdd);break;case 1001:s.success(n.gdd,n.gdd.codesc);break;case 4e3:n.gdd.msg="VALIDATION ERROR: "+n.gdd.msg,s.validation?s.validation(n.gdd):s.fail(n.gdd);break;case 4002:gdd.session.signOut();break;case 4001:n.gdd.msg="ACCESS DENIED: "+n.gdd.msg,s.fail(n.gdd);break;case 5e3:n.gdd.msg="SERVER ERROR: "+n.gdd.msg,s.fail(n.gdd);break;case 5001:n.gdd.msg="ERROR: "+n.gdd.msg,s.fail(n.gdd)}else n.gdd=n.gdd||{},n.gdd.msg="The response from the server was not correctly formatted. Please contact support.",s.fail(n.gdd)}})}}}),define("global/storage",[],function(){var e=function(e,t){var n=t.getItem(e);if(!n)return t.removeItem(e),null;try{return $.parseJSON(n)}catch(r){return t.removeItem(e),null}},t=function(e,t,n){e?n.setItem(t,JSON.stringify(e)):n.removeItem(t)},n="glb_authkey",r="ses_authkey",i="ses_grpref_",s="ses_account",o="perm_evregcache",u="glb_facgeostruc",a="ses_publicaccesstoken";return{signOut:function(){var e=new Array;for(var t=0;t<localStorage.length;t++){var n=localStorage.key(t).split("_")[0];n!="perm"&&e.push(localStorage.key(t))}$.each(e,function(e,t){localStorage.removeItem(t)}),e.length=0;for(var t=0;t<sessionStorage.length;t++){var n=sessionStorage.key(t).split("_")[0];n!="perm"&&e.push(sessionStorage.key(t))}$.each(e,function(e,t){sessionStorage.removeItem(t)})},getPublicAccessToken:function(){return e(a,localStorage)},savePublicAccessToken:function(e){t(e,a,localStorage)},getAuthInfo:function(){return e(n,localStorage)},saveAuthInfo:function(e){t(e,n,localStorage)},getSessionInfo:function(){return e(r,localStorage)},saveSessionInfo:function(e){t(e,r,localStorage)},getGrpRefData:function(){return e(i+gdd.session.activeSession.portalId(),localStorage)},saveGrpRefData:function(e){t(e,i+gdd.session.activeSession.portalId(),localStorage)},getAccountData:function(){return e(s,localStorage)},saveAccountData:function(e){t(e,s,localStorage)},getEventRegCache:function(){return e(o,localStorage)},saveEventRegCache:function(e){t(e,o,localStorage)},getFacGeoStruc:function(){return e(u,localStorage)},saveFacGeoStruc:function(e){t(e,u,localStorage)}}}),define("global/cache",[],function(){return{appPortals:ko.observableArray()}}),define("global/nms",["views/views","global/session","global/utils","global/api","global/storage","global/cache"],function(e,t,n,r,i,s){return{cache:s,pages:e,session:t,utils:n,api:r,storage:i,permissions:function(){return gdd.session?gdd.session.activeSession?gdd.session.activeSession.permissions:null:null},loadPage:function(e,t,r){n.loadPage(e,t,r)},portalId:function(){return gdd.session.activeSession.portalId()},portalName:function(){return gdd.session.activeSession.portalName()},tap:function(){return n.tap},click:function(){return n.click},showMsg:function(e,t){n.showMsg(e,t)},showWarning:function(e,t){n.showWarning(e,t)},showErr:function(e,t){n.showErr(e,t)},showPopup:function(e,t,r){n.showPopup(e,t,r)},hideLoader:function(){n.hideLoader()},showLoader:function(e){n.showLoader(e)}}}),window.gdd=null,requirejs.onError=function(e){window.gddAppRestart()},requirejs.config({paths:{},shim:{}}),requirejs(["global/nms"],function(e){e.session.appInfo=window.gddAppInfo,window.gdd=e,gdd.utils.activePage=e.pages.index,gdd.utils.appStart()}),define("start",function(){});